<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9"/>
<title>ZWSoft ZRX for ZWCAD: Developer Guide: Custom Entity UI</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">ZWSoft ZRX for ZWCAD: Developer Guide
   &#160;<span id="projectnumber">2022</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Custom Entity UI<div class="ingroups"><a class="el" href="group___custom_obj.html">Custom Objects</a> &raquo; <a class="el" href="group___der_ac_db_ent.html">Deriving from AcDbEntity</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<p>The following code shows the implementation for Register the command to create a custom entity. <br />
 If you want to learn more about "JigSign"command you can check out the next chapter"Using AcEdJig". </p><div class="fragment"><div class="line"><span class="keyword">extern</span> <span class="keywordtype">void</span> JigSign();</div>
<div class="line"><span class="keywordtype">void</span> initApp();</div>
<div class="line"><span class="keywordtype">void</span> unloadApp();</div>
<div class="line"><span class="keywordtype">void</span> RegisterZrxApp();</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">// ZRX EntryPoint</span></div>
<div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> AcRx::AppRetCode </div>
<div class="line">    zcrxEntryPoint(AcRx::AppMsgCode msg, <span class="keywordtype">void</span>* pkt)</div>
<div class="line">{</div>
<div class="line">    AcRxDynamicLinker *pLinker = acrxDynamicLinker;</div>
<div class="line">    <span class="keywordflow">switch</span> (msg) {</div>
<div class="line">    <span class="keywordflow">case</span> AcRx::kInitAppMsg:</div>
<div class="line">        <span class="comment">// Comment out the following line if your</span></div>
<div class="line">        <span class="comment">// application should be locked into memory</span></div>
<div class="line">        pLinker-&gt;unlockApplication(pkt);</div>
<div class="line">        pLinker-&gt;registerAppMDIAware(pkt);</div>
<div class="line">        <span class="comment">// check if the zrx app is loaded or not.</span></div>
<div class="line">        <span class="comment">// if not, load it as UI so that we won&#39;t have</span></div>
<div class="line">        <span class="comment">// proxy if this dll is unloaded by OS</span></div>
<div class="line">        <span class="keywordflow">if</span> (!::acrxAppIsLoaded(_T(<span class="stringliteral">&quot;SignDb.zrx&quot;</span>)))</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (!pLinker-&gt;loadModule(_T(<span class="stringliteral">&quot;SignDb.zrx&quot;</span>), <span class="keyword">false</span>, <span class="keyword">true</span>))</div>
<div class="line">                <span class="keywordflow">return</span> AcRx::kRetError;</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// bump the reference count </span></div>
<div class="line">        pLinker-&gt;loadModule(_T(<span class="stringliteral">&quot;SignDb.zrx&quot;</span>), <span class="keyword">false</span>, <span class="keyword">false</span>);</div>
<div class="line">        initApp();</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> AcRx::kUnloadAppMsg:</div>
<div class="line">        pLinker-&gt;unloadModule(_T(<span class="stringliteral">&quot;SignDb.zrx&quot;</span>));</div>
<div class="line">        unloadApp();</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> AcRx::kRetOK;</div>
<div class="line">}</div>
<div class="line"><span class="keywordtype">void</span> sign()</div>
<div class="line">{</div>
<div class="line">    ZsdkSign* pSign = (ZsdkSign*)ZsdkSign::desc()-&gt;create();</div>
<div class="line">    pSign-&gt;setDatabaseDefaults();</div>
<div class="line">    pSign-&gt;setCenter(AcGePoint3d::kOrigin);</div>
<div class="line">    pSign-&gt;setNormal(AcGeVector3d::kZAxis);</div>
<div class="line">    pSign-&gt;setRadius(50);</div>
<div class="line">    pSign-&gt;setText(_T(<span class="stringliteral">&quot;TEST&quot;</span>));</div>
<div class="line"></div>
<div class="line">    AcDbBlockTable *pBlockTable;</div>
<div class="line">    acdbHostApplicationServices()-&gt;workingDatabase()-&gt;getSymbolTable(pBlockTable, AcDb::kForRead);</div>
<div class="line"></div>
<div class="line">    AcDbBlockTableRecord *pBlockTableRecord;</div>
<div class="line">    pBlockTable-&gt;getAt(ACDB_MODEL_SPACE, pBlockTableRecord, AcDb::kForWrite);</div>
<div class="line">    pBlockTable-&gt;close();</div>
<div class="line"></div>
<div class="line">    AcDbObjectId lineId;</div>
<div class="line">    ErrorStatus es = pBlockTableRecord-&gt;appendAcDbEntity(lineId, pSign);</div>
<div class="line"></div>
<div class="line">    pBlockTableRecord-&gt;close();</div>
<div class="line">    acutPrintf(_T(<span class="stringliteral">&quot;\nBefore close.&quot;</span>));</div>
<div class="line">    pSign-&gt;close();</div>
<div class="line">}</div>
<div class="line"><span class="comment">// Init this application. Register your</span></div>
<div class="line"><span class="comment">// commands, reactors...</span></div>
<div class="line"><span class="keywordtype">void</span> initApp()</div>
<div class="line">{</div>
<div class="line">    acedRegCmds-&gt;addCommand(_T(<span class="stringliteral">&quot;JIGSIGN&quot;</span>), _T(<span class="stringliteral">&quot;JIGSIGN&quot;</span>), _T(<span class="stringliteral">&quot;JIGSIGN&quot;</span>), ACRX_CMD_MODAL, JigSign);</div>
<div class="line">    acedRegCmds-&gt;addCommand(_T(<span class="stringliteral">&quot;ZSDK_SIGN&quot;</span>), _T(<span class="stringliteral">&quot;ZSDK_SIGN&quot;</span>), _T(<span class="stringliteral">&quot;SIGN&quot;</span>), ACRX_CMD_MODAL, sign);</div>
<div class="line">    RegisterZrxApp();</div>
<div class="line">    <span class="comment">//InitAcUiDLL();</span></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Unload this application. Unregister all objects</span></div>
<div class="line"><span class="comment">// registered in initApp.</span></div>
<div class="line"><span class="keywordtype">void</span> unloadApp()</div>
<div class="line">{</div>
<div class="line">    acedRegCmds-&gt;removeGroup(_T(<span class="stringliteral">&quot;ZSDK_SIGN&quot;</span>));</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> RegisterZrxApp()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Fill the AppInfo structure with our demand loading details.</span></div>
<div class="line">    AcadAppInfo appInfo;</div>
<div class="line">    appInfo.setAppName(_T(<span class="stringliteral">&quot;SignUi&quot;</span>));<span class="comment">// Application Name</span></div>
<div class="line">    appInfo.setModuleName(acedGetAppName());<span class="comment">// ZRX File Location</span></div>
<div class="line">    appInfo.setAppDesc(_T(<span class="stringliteral">&quot;SignUi Sample&quot;</span>)); <span class="comment">// Description</span></div>
<div class="line">    appInfo.setLoadReason( <span class="comment">// Specify when we want this to load</span></div>
<div class="line">        AcadApp::LoadReasons(</div>
<div class="line">        AcadApp::kOnCommandInvocation |</div>
<div class="line">        AcadApp::kOnLoadRequest));</div>
<div class="line"></div>
<div class="line">    appInfo.writeToRegistry(<span class="keyword">false</span>,<span class="keyword">true</span>);<span class="comment">// Write the AppInfo to the registry, don&#39;t write to DBX registry section.</span></div>
<div class="line">    appInfo.writeGroupNameToRegistry(_T(<span class="stringliteral">&quot;ZSDK_SIGN&quot;</span>)); <span class="comment">// Write the Group Name</span></div>
<div class="line">    appInfo.writeCommandNameToRegistry(_T(<span class="stringliteral">&quot;SIGN&quot;</span>),_T(<span class="stringliteral">&quot;SIGN&quot;</span>));<span class="comment">// Write our command.</span></div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<hr class="footer"/><address class="footer"><small>
<a href="https://www.zwsoft.com/zwcad/Developers/">
<img class="footer" src="zwsoft.png" alt="zwsoft"/></br>
</a>
&copy; 1998-2022  Copyright ZWSOFT CO., LTD(Guangzhou)</br>
All rights reserved.
</small></address>
</body>
</html>

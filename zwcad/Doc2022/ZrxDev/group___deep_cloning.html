<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9"/>
<title>ZWSoft ZRX for ZWCAD: Developer Guide: Deep Cloning</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">ZWSoft ZRX for ZWCAD: Developer Guide
   &#160;<span id="projectnumber">2022</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Deep Cloning<div class="ingroups"><a class="el" href="group___advanced_topics.html">Advanced Topics</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<p>This part shows the deep clone functions, by using the deepCloneOjbects interface of AcDbDataBase. <br />
 Acad::ErrorStatus deepCloneObjects(AcDbObjectIdArray&amp; objectIds,AcDbObjectId&amp; owner,AcDbIdMapping&amp; idMap,bool deferXlation = false); <br />
 ObjectIds <br />
 Enter an array of objects to be deeply cloned <br />
 Owner <br />
 Enter the object ID that is the object of the owner of the clone <br />
 IdMap <br />
 Returns an array of AcDbIdPair objects used to transform ID relations of objects <br />
 DeferXlation <br />
 Enter Boolean values to indicate whether to perform ID transformation</p>
<p>Clone all objects in the objectId array and add them to the container object specified by owner. IdMap stores the AcDbIdPair object, which contains the objectId entity of the original and cloned object pairs. AcDbIdPair. This array can be used to pre process objects contained in deep cloning operations. When all the objects to be cloned do not have the same host, a separate AcDbObjectIdArray entity must be established, each AcDbObjectIdArray entity containing objects with all the same host. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> DeepClone::CloneObject(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    ads_name name;</div>
<div class="line">    acedSSGet(_T(<span class="stringliteral">&quot;A&quot;</span>), NULL, NULL, NULL, name);</div>
<div class="line">    <span class="keywordtype">long</span> entCount;</div>
<div class="line">    acedSSLength(name, &amp;entCount);</div>
<div class="line">    <span class="keywordflow">if</span> (entCount &lt; 1)</div>
<div class="line">    {</div>
<div class="line">        return ;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    AcDbObjectIdArray entArr;</div>
<div class="line">    AcDbObjectId entID;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i &lt; entCount; i++)</div>
<div class="line">    {</div>
<div class="line">        ads_name entName;</div>
<div class="line">        acedSSName(name, i, entName);</div>
<div class="line">        acdbGetObjectId(entID, entName);</div>
<div class="line">        entArr.append(entID);</div>
<div class="line">    }</div>
<div class="line">    acedSSFree(name);</div>
<div class="line"></div>
<div class="line">    AcDbDatabase *pDb = acdbHostApplicationServices()-&gt;workingDatabase();</div>
<div class="line">    <span class="keywordflow">if</span> (pDb != NULL)</div>
<div class="line">    {</div>
<div class="line">        AcDbBlockTable* pBlockTable=NULL;</div>
<div class="line">        AcDbObjectId entId=AcDbObjectId::kNull;</div>
<div class="line">        Acad::ErrorStatus es=Acad::eOk;</div>
<div class="line">        es=pDb-&gt;getBlockTable(pBlockTable, AcDb::kForRead);</div>
<div class="line">        <span class="keywordflow">if</span> (es==Acad::eOk)</div>
<div class="line">        {</div>
<div class="line">            AcDbObjectId pBlockTableRecord;</div>
<div class="line">            es=pBlockTable-&gt;getAt(ACDB_MODEL_SPACE, pBlockTableRecord, AcDb::kForWrite);</div>
<div class="line">            pBlockTable-&gt;close();</div>
<div class="line">            <span class="keywordflow">if</span> (es==Acad::eOk)</div>
<div class="line">            {</div>
<div class="line">                AcDbIdMapping entMap;</div>
<div class="line">                pDb-&gt;deepCloneObjects(entArr, pBlockTableRecord, entMap);</div>
<div class="line">                AcDbIdMappingIter entMapIt(entMap);</div>
<div class="line">                <span class="keywordflow">for</span> (entMapIt.start(); !entMapIt.done(); entMapIt.next())</div>
<div class="line">                {</div>
<div class="line">                    AcDbIdPair entPair;</div>
<div class="line">                    entMapIt.getMap(entPair);</div>
<div class="line">                    <span class="keywordflow">if</span> (entPair.isCloned())</div>
<div class="line">                    {</div>
<div class="line">                        acutPrintf(_T(<span class="stringliteral">&quot;\nObjectID : %d&quot;</span>), entPair.value().asOldId());</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
</div><!-- fragment --> </div><!-- contents -->
<hr class="footer"/><address class="footer"><small>
<a href="https://www.zwsoft.com/zwcad/Developers/">
<img class="footer" src="zwsoft.png" alt="zwsoft"/></br>
</a>
&copy; 1998-2022  Copyright ZWSOFT CO., LTD(Guangzhou)</br>
All rights reserved.
</small></address>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9"/>
<title>ZWSoft ZRX for ZWCAD: Developer Guide: Protocol Extension</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">ZWSoft ZRX for ZWCAD: Developer Guide
   &#160;<span id="projectnumber">2022</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Protocol Extension<div class="ingroups"><a class="el" href="group___advanced_topics.html">Advanced Topics</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<p>The following example demonstrates to create a protocol extension . <br />
 The implementation of the setcolor() function for the SETCOLOR command, which allows the user to select an entity and then set different color for that entity. <br />
 circle:set green <br />
 default:set blue <br />
 line:set red </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;rxobject.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;rxregsvc.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;rxdlinkr.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;rxditer.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;aced.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;adslib.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;dbents.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;dbregion.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;dbdict.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;dbsymtb.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;tchar.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> initApp();</div>
<div class="line"><span class="keywordtype">void</span> unloadApp();</div>
<div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span></div>
<div class="line">    AcRx::AppRetCode acrxEntryPoint(AcRx::AppMsgCode, <span class="keywordtype">void</span>*);</div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>ZsdkEntSetColor : <span class="keyword">public</span> AcRxObject</div>
<div class="line"></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    ACRX_DECLARE_MEMBERS(ZsdkEntSetColor);</div>
<div class="line">    <span class="keyword">virtual</span> Acad::ErrorStatus setColor(AcDbEntity*) <span class="keyword">const</span> = 0;</div>
<div class="line">};</div>
<div class="line">ACRX_NO_CONS_DEFINE_MEMBERS(ZsdkEntSetColor, AcRxObject);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>ZsdkDefaultSetColor : <span class="keyword">public</span> ZsdkEntSetColor</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"></div>
<div class="line">    <span class="keyword">virtual</span> Acad::ErrorStatus setColor(AcDbEntity* pEnt) <span class="keyword">const</span>;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line">Acad::ErrorStatus</div>
<div class="line">    ZsdkDefaultSetColor::setColor(</div>
<div class="line">    AcDbEntity* pEnt)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    acutPrintf(_T(<span class="stringliteral">&quot;\nDefault:set blue \n&quot;</span>));</div>
<div class="line">    <span class="keywordflow">return</span> pEnt-&gt;setColorIndex(5);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>ZsdkLineSetColor : <span class="keyword">public</span> ZsdkEntSetColor</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// ZsdkEntSetColor implementation for Lines.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">virtual</span> Acad::ErrorStatus setColor(AcDbEntity* pEnt) <span class="keyword">const</span>;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line">Acad::ErrorStatus</div>
<div class="line">    ZsdkLineSetColor::setColor(</div>
<div class="line">    AcDbEntity* pEnt)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    AcDbLine *pLine = AcDbLine::cast(pEnt);</div>
<div class="line">    acutPrintf(_T(<span class="stringliteral">&quot;\nline:set red \n&quot;</span>));</div>
<div class="line">    <span class="keywordflow">return</span> pLine-&gt;setColorIndex(1);</div>
<div class="line"></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>ZsdkCircleSetColor : <span class="keyword">public</span> ZsdkEntSetColor</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// ZsdkEntSetColor implementation for circles.</span></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"></div>
<div class="line">    <span class="keyword">virtual</span> Acad::ErrorStatus setColor(AcDbEntity* pEnt) <span class="keyword">const</span>;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">Acad::ErrorStatus</div>
<div class="line">    ZsdkCircleSetColor::setColor(</div>
<div class="line">    AcDbEntity* pEnt)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    AcDbCircle *pCircle = AcDbCircle::cast(pEnt);</div>
<div class="line">    acutPrintf(_T(<span class="stringliteral">&quot;\ncircle:set green \n&quot;</span>));</div>
<div class="line">    <span class="keywordflow">return</span> pCircle-&gt;setColorIndex(3);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">// This function has the user select an entity and then</span></div>
<div class="line"><span class="comment">// calls the setColor() function in the protocol</span></div>
<div class="line"><span class="comment">// extension class attached to that entity&#39;s class.</span></div>
<div class="line"><span class="comment">// </span></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">    setcolor()</div>
<div class="line">{</div>
<div class="line">    AcDbEntity *pEnt;</div>
<div class="line">    AcDbObjectId pEntId;</div>
<div class="line">    ads_name en;</div>
<div class="line">    ads_point pt;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (acedEntSel(_T(<span class="stringliteral">&quot;\nSelect an Entity:  &quot;</span>), en, pt)</div>
<div class="line">        != RTNORM)</div>
<div class="line">    {</div>
<div class="line">        acutPrintf(_T(<span class="stringliteral">&quot;Nothing Selected\n&quot;</span>));</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">    acdbGetObjectId(pEntId, en);</div>
<div class="line">    acdbOpenObject(pEnt, pEntId, AcDb::kForWrite);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// call the protocol extension class&#39;s method</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordtype">double</span> eTemp = ACRX_X_CALL(pEnt,</div>
<div class="line">        ZsdkEntSetColor)-&gt;setColor(pEnt);</div>
<div class="line"></div>
<div class="line">    pEnt-&gt;close();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">// Pointers for Protocol Extension Objects.  These pointers</span></div>
<div class="line"><span class="comment">// are global so that they can be accessed during</span></div>
<div class="line"><span class="comment">// initialization *and* cleanup</span></div>
<div class="line"><span class="comment">// </span></div>
<div class="line">ZsdkDefaultSetColor *pDefaultTemp;</div>
<div class="line">ZsdkLineSetColor *pLineTemp;</div>
<div class="line">ZsdkCircleSetColor *pCircleTemp;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">    initApp()</div>
<div class="line">{</div>
<div class="line">    acrxRegisterService(_T(<span class="stringliteral">&quot;ZsdkSetColor&quot;</span>));</div>
<div class="line"></div>
<div class="line">    ZsdkEntSetColor::rxInit();</div>
<div class="line">    acrxBuildClassHierarchy();</div>
<div class="line"></div>
<div class="line">    pDefaultTemp = <span class="keyword">new</span> ZsdkDefaultSetColor();</div>
<div class="line">    pLineTemp = <span class="keyword">new</span> ZsdkLineSetColor();</div>
<div class="line">    pCircleTemp = <span class="keyword">new</span> ZsdkCircleSetColor();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Add the protocol extension objects to the appropriate</span></div>
<div class="line">    <span class="comment">// AcRxClass objects</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    AcDbEntity::desc()-&gt;addX(ZsdkEntSetColor::desc(),</div>
<div class="line">        pDefaultTemp);</div>
<div class="line">    AcDbLine::desc()-&gt;addX(ZsdkEntSetColor::desc(),</div>
<div class="line">        pLineTemp);</div>
<div class="line">    AcDbCircle::desc()-&gt;addX(ZsdkEntSetColor::desc(),</div>
<div class="line">        pCircleTemp);</div>
<div class="line"></div>
<div class="line">    acedRegCmds-&gt;addCommand(_T(<span class="stringliteral">&quot;Zsdk_SetColor_APP&quot;</span>),</div>
<div class="line">        _T(<span class="stringliteral">&quot;Zsdk_SETCOLOR&quot;</span>), _T(<span class="stringliteral">&quot;setcolor&quot;</span>), ACRX_CMD_TRANSPARENT,</div>
<div class="line">        setcolor);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">    unloadApp()</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">delete</span> acrxServiceDictionary-&gt;remove(_T(<span class="stringliteral">&quot;ZsdkSetColor&quot;</span>));</div>
<div class="line">    acedRegCmds-&gt;removeGroup(_T(<span class="stringliteral">&quot;Zsdk_SetColor_APP&quot;</span>));</div>
<div class="line"></div>
<div class="line">    AcDbEntity::desc()-&gt;delX(ZsdkEntSetColor::desc());</div>
<div class="line">    <span class="keyword">delete</span> pDefaultTemp;</div>
<div class="line">    AcDbLine::desc()-&gt;delX(ZsdkEntSetColor::desc());</div>
<div class="line">    <span class="keyword">delete</span> pLineTemp;</div>
<div class="line">    AcDbCircle::desc()-&gt;delX(ZsdkEntSetColor::desc());</div>
<div class="line">    <span class="keyword">delete</span> pCircleTemp;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Remove the ZsdkEntSetColor class from the ZRX</span></div>
<div class="line">    <span class="comment">// runtime class hierarchy.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    deleteAcRxClass(ZsdkEntSetColor::desc());</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">AcRx::AppRetCode</div>
<div class="line">    acrxEntryPoint(AcRx::AppMsgCode msg, <span class="keywordtype">void</span>* appId)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">switch</span> (msg) {</div>
<div class="line">    <span class="keywordflow">case</span> AcRx::kInitAppMsg:</div>
<div class="line">        acrxDynamicLinker-&gt;unlockApplication(appId);</div>
<div class="line">        acrxDynamicLinker-&gt;registerAppMDIAware(appId);</div>
<div class="line">        initApp();</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> AcRx::kUnloadAppMsg:</div>
<div class="line">        unloadApp();</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> AcRx::kRetOK;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<hr class="footer"/><address class="footer"><small>
<a href="https://www.zwsoft.com/zwcad/Developers/">
<img class="footer" src="zwsoft.png" alt="zwsoft"/></br>
</a>
&copy; 1998-2022  Copyright ZWSOFT CO., LTD(Guangzhou)</br>
All rights reserved.
</small></address>
</body>
</html>

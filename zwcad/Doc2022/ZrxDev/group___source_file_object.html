<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9"/>
<title>ZWSoft ZRX for ZWCAD: Developer Guide: Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">ZWSoft ZRX for ZWCAD: Developer Guide
   &#160;<span id="projectnumber">2022</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Source File<div class="ingroups"><a class="el" href="group___custom_obj.html">Custom Objects</a> &raquo; <a class="el" href="group___der_ac_db_obj.html">Deriving from AcDbobject</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<p>The following code shows the implementation for the new class DwgAuthor: </p><div class="fragment"><div class="line"><span class="preprocessor">#define VERSION_DWGAUTHOR 1</span></div>
<div class="line"></div>
<div class="line">ACRX_DXF_DEFINE_MEMBERS(DwgAuthor, AcDbObject,</div>
<div class="line">                        AcDb::kDHL_CURRENT, AcDb::kMReleaseCurrent,</div>
<div class="line">                        AcDbProxyObject::kNoOperation,</div>
<div class="line">                        DWGAUTHOR, DWGAUTHOR);</div>
<div class="line"></div>
<div class="line">DwgAuthor::DwgAuthor()</div>
<div class="line">{</div>
<div class="line">    m_DwgAuthor = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">DwgAuthor::~DwgAuthor()</div>
<div class="line">{</div>
<div class="line"></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">Acad::ErrorStatus DwgAuthor::dwgInFields(AcDbDwgFiler* pFiler)</div>
<div class="line">{</div>
<div class="line">    assertWriteEnabled();</div>
<div class="line">    Acad::ErrorStatus es;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Call dwgInFields from AcDbObject</span></div>
<div class="line">    <span class="keywordflow">if</span> ((es = AcDbObject::dwgInFields(pFiler)) != Acad::eOk) {</div>
<div class="line">        <span class="keywordflow">return</span> es;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Read version number.</span></div>
<div class="line">    Adesk::UInt16 version;</div>
<div class="line">    pFiler-&gt;readItem(&amp;version);</div>
<div class="line">    <span class="keywordflow">if</span> (version &gt; VERSION_DWGAUTHOR)</div>
<div class="line">        <span class="keywordflow">return</span> Acad::eMakeMeProxy;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Read the data members.</span></div>
<div class="line">    <span class="keywordflow">switch</span> (version)</div>
<div class="line">    {</div>
<div class="line">    <span class="keywordflow">case</span> (1):</div>
<div class="line">        <span class="comment">// TODO: here you can file datamembers not</span></div>
<div class="line">        ACHAR* pszBuf = NULL;</div>
<div class="line">        pFiler-&gt;readString(&amp;pszBuf);</div>
<div class="line">        m_DwgAuthor = AcString(pszBuf);</div>
<div class="line">        delString(pszBuf);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> pFiler-&gt;filerStatus();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">Acad::ErrorStatus DwgAuthor::dwgOutFields(AcDbDwgFiler* pFiler)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    assertReadEnabled();</div>
<div class="line">    Acad::ErrorStatus es;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Call dwgOutFields from AcDbObject</span></div>
<div class="line">    <span class="keywordflow">if</span> ((es = AcDbObject::dwgOutFields(pFiler)) != Acad::eOk) {</div>
<div class="line">        <span class="keywordflow">return</span> es;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Write version number.</span></div>
<div class="line">    pFiler-&gt;writeItem((Adesk::UInt16) VERSION_DWGAUTHOR);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Write the data members.</span></div>
<div class="line">    <span class="comment">// TODO: here you can file datamembers not</span></div>
<div class="line">    pFiler-&gt;writeString((LPCTSTR)m_DwgAuthor);</div>
<div class="line">    <span class="keywordflow">return</span> pFiler-&gt;filerStatus();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">Acad::ErrorStatus DwgAuthor::dxfInFields(AcDbDxfFiler* pFiler)</div>
<div class="line">{</div>
<div class="line">    assertWriteEnabled();</div>
<div class="line">    <span class="keyword">struct </span>resbuf rb;</div>
<div class="line"></div>
<div class="line">    Acad::ErrorStatus es = AcDbObject::dxfInFields( pFiler );</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( Acad::eOk != es ) {</div>
<div class="line">        <span class="keywordflow">return</span> es;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Check that we are at the correct subclass data</span></div>
<div class="line">    <span class="keywordflow">if</span>( !pFiler-&gt;atSubclassData( _T(<span class="stringliteral">&quot;DwgAuthor&quot;</span>) ))</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> Acad::eBadDxfSequence;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Read version number.</span></div>
<div class="line">    pFiler-&gt;readItem(&amp;rb);</div>
<div class="line">    <span class="keywordflow">if</span> (rb.restype != AcDb::kDxfInt16) {</div>
<div class="line">        pFiler-&gt;pushBackItem();</div>
<div class="line">        pFiler-&gt;setError(Acad::eInvalidDxfCode,</div>
<div class="line">            _T(<span class="stringliteral">&quot;nError: expected object version group code %d&quot;</span>),</div>
<div class="line">            AcDb::kDxfInt16);</div>
<div class="line">        <span class="keywordflow">return</span> pFiler-&gt;filerStatus();</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        Adesk::UInt16 version = rb.resval.rint;</div>
<div class="line">        <span class="keywordflow">if</span> (version &gt; VERSION_DWGAUTHOR)</div>
<div class="line">            <span class="keywordflow">return</span> Acad::eMakeMeProxy;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    pFiler-&gt;readItem(&amp;rb);</div>
<div class="line">    <span class="keywordflow">if</span> (rb.restype == AcDb::kDxfText) </div>
<div class="line">    {</div>
<div class="line">        m_DwgAuthor = AcString(rb.resval.rstring);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> pFiler-&gt;filerStatus();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">Acad::ErrorStatus DwgAuthor::dxfOutFields(AcDbDxfFiler* pFiler)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    assertReadEnabled();</div>
<div class="line">    Acad::ErrorStatus es;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ((es = AcDbObject::dxfOutFields(pFiler)) != Acad::eOk)</div>
<div class="line">        <span class="keywordflow">return</span> es;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Write subclass marker.</span></div>
<div class="line">    pFiler-&gt;writeItem(AcDb::kDxfSubclass, _T(<span class="stringliteral">&quot;DwgAuthor&quot;</span>));</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Write version number.</span></div>
<div class="line">    pFiler-&gt;writeItem(AcDb::kDxfInt16, (Adesk::UInt16) VERSION_DWGAUTHOR);</div>
<div class="line"></div>
<div class="line">    pFiler-&gt;writeString(AcDb::kDxfText, (LPCTSTR)m_DwgAuthor);</div>
<div class="line">    <span class="keywordflow">return</span> es;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> DwgAuthor::SetDwgAuthor( AcString DwgAuthor)</div>
<div class="line">{</div>
<div class="line">    assertWriteEnabled();</div>
<div class="line"></div>
<div class="line">    m_DwgAuthor = DwgAuthor;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">AcString DwgAuthor::GetDwgAuthor()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    assertReadEnabled();</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> m_DwgAuthor;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> CString DWG_AUTHOR_KEY = TEXT(<span class="stringliteral">&quot;DwgAuthor&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="comment">// This is command &#39;SETDwgAuthor&#39;</span></div>
<div class="line"><span class="keywordtype">void</span> SetDwgAuthor()</div>
<div class="line">{</div>
<div class="line">    ACHAR AuthorName[1024] = {0};</div>
<div class="line">    acedGetString(0,_T(<span class="stringliteral">&quot;input Dwg Author nameï¼š&quot;</span>),AuthorName);</div>
<div class="line"></div>
<div class="line">    AcDbDictionary *pNameObjDict = NULL;</div>
<div class="line">    acdbHostApplicationServices()-&gt;workingDatabase()</div>
<div class="line">        -&gt;getNamedObjectsDictionary(pNameObjDict, AcDb::kForWrite);</div>
<div class="line">    AcDbObjectId dictObjId;</div>
<div class="line">    DwgAuthor *pDwgAuthor = <span class="keyword">new</span> DwgAuthor();</div>
<div class="line">    pDwgAuthor-&gt;SetDwgAuthor(AuthorName);</div>
<div class="line">    pNameObjDict-&gt;setAt(DWG_AUTHOR_KEY, pDwgAuthor, dictObjId);</div>
<div class="line">    pDwgAuthor-&gt;close();</div>
<div class="line">    pNameObjDict-&gt;close();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// This is command &#39;GETDwgAuthor&#39;</span></div>
<div class="line"><span class="keywordtype">void</span> GetDwgAuthor()</div>
<div class="line">{</div>
<div class="line">    AcDbDictionary *pNameObjDict = NULL;</div>
<div class="line">    Acad::ErrorStatus es;</div>
<div class="line">    acdbHostApplicationServices()-&gt;workingDatabase()</div>
<div class="line">        -&gt;getNamedObjectsDictionary(pNameObjDict, AcDb::kForRead);</div>
<div class="line">    DwgAuthor *pDwgAuthor = NULL;</div>
<div class="line">    es = pNameObjDict-&gt;getAt(DWG_AUTHOR_KEY, (AcDbObject*&amp;)pDwgAuthor, AcDb::kForRead);</div>
<div class="line">    pNameObjDict-&gt;close();</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (es == Acad::eKeyNotFound)</div>
<div class="line">    {</div>
<div class="line">        acutPrintf(TEXT(<span class="stringliteral">&quot;\nnot exist%s.&quot;</span>), DWG_AUTHOR_KEY);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">    acutPrintf(TEXT(<span class="stringliteral">&quot;\n Dwg Author is :&quot;</span>));</div>
<div class="line">    acutPrintf(pDwgAuthor-&gt;GetDwgAuthor());</div>
<div class="line">    pDwgAuthor-&gt;close();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> initApp()</div>
<div class="line">{ </div>
<div class="line">    <span class="comment">// register a command with the ZWCAD command mechanism for edit this data member &quot;m_DwgAuthor&quot;</span></div>
<div class="line">    acedRegCmds-&gt;addCommand(_T(<span class="stringliteral">&quot;DwgAuthor&quot;</span>), _T(<span class="stringliteral">&quot;SetDwgAuthor&quot;</span>), _T(<span class="stringliteral">&quot;SetDwgAuthor&quot;</span>), ACRX_CMD_MODAL, SetDwgAuthor);</div>
<div class="line">    acedRegCmds-&gt;addCommand(_T(<span class="stringliteral">&quot;DwgAuthor&quot;</span>), _T(<span class="stringliteral">&quot;GetDwgAuthor&quot;</span>), _T(<span class="stringliteral">&quot;GetDwgAuthor&quot;</span>), ACRX_CMD_MODAL, GetDwgAuthor);</div>
<div class="line">    <span class="comment">//Register a new custom class with the following code:</span></div>
<div class="line">    DwgAuthor::rxInit();</div>
<div class="line">    acrxBuildClassHierarchy();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> unloadApp()</div>
<div class="line">{ </div>
<div class="line">    acedRegCmds-&gt;removeGroup(_T(<span class="stringliteral">&quot;DwgAuthor&quot;</span>));</div>
<div class="line">    <span class="comment">//Unregister a new custom class with the following code:</span></div>
<div class="line">    deleteAcRxClass(DwgAuthor::desc());</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<hr class="footer"/><address class="footer"><small>
<a href="https://www.zwsoft.com/zwcad/Developers/">
<img class="footer" src="zwsoft.png" alt="zwsoft"/></br>
</a>
&copy; 1998-2022  Copyright ZWSOFT CO., LTD(Guangzhou)</br>
All rights reserved.
</small></address>
</body>
</html>

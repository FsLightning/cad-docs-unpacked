<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9"/>
<title>ZWSoft ZRX for ZWCAD: Developer Guide: Transaction Management</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">ZWSoft ZRX for ZWCAD: Developer Guide
   &#160;<span id="projectnumber">2022</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Transaction Management<div class="ingroups"><a class="el" href="group___advanced_topics.html">Advanced Topics</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<p>This section describes the transaction model, which can be used to operate on objects. <br />
 In this model, multiple operations on multiple objects are grouped together into one atomic operation called a transaction. <br />
 Create some multiple objects and post it to the database. <br />
 Start Transaction 1: Create a line . <br />
 Start Transaction 2: Create a circle. <br />
 Start Transaction 3: Create a text. <br />
 Abort the transaction? Answer yes. <br />
 End Transaction 3. <br />
 End Transaction 2. <br />
 Note <br />
 If you abort at this point, Transactions 2 and 3 are both canceled. If you abort a containing transaction, all the nested transactions are aborted, even if they were successfully ended. <br />
 End Transaction 1. </p><div class="fragment"><div class="line">Acad::ErrorStatus</div>
<div class="line">    getYOrN(TCHAR* promptStr, Adesk::Boolean defaultY, Adesk::Boolean&amp; yes,Adesk::Boolean&amp; interrupted)</div>
<div class="line">{</div>
<div class="line">    TCHAR option[256];</div>
<div class="line">    yes = Adesk::kTrue;</div>
<div class="line"></div>
<div class="line">    acedInitGet(0, _T(<span class="stringliteral">&quot;Yes No&quot;</span>));</div>
<div class="line">    <span class="keywordtype">int</span> as = acedGetKword(promptStr, option);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">switch</span> (as) {</div>
<div class="line">    <span class="keywordflow">case</span> RTNORM:</div>
<div class="line">        <span class="keywordflow">if</span> (_tcscmp(option, _T(<span class="stringliteral">&quot;Yes&quot;</span>)) == 0)</div>
<div class="line">            yes = Adesk::kTrue;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            yes = Adesk::kFalse;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> RTNONE:</div>
<div class="line">        <span class="keywordflow">if</span> (defaultY)</div>
<div class="line">            yes = Adesk::kTrue;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            yes = Adesk::kFalse;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> RTCAN:</div>
<div class="line">        interrupted = Adesk::kTrue;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> Acad::eOk;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> testTransaction()</div>
<div class="line">{</div>
<div class="line"></div>
<div class="line">    AcTransaction *pTrans</div>
<div class="line">        = actrTransactionManager-&gt;startTransaction();</div>
<div class="line">    assert(pTrans != NULL);</div>
<div class="line">    acutPrintf(_T(<span class="stringliteral">&quot;\n\n&gt;&gt;&gt;&gt;&gt;&gt;  Started transaction one.&quot;</span>)</div>
<div class="line">        _T(<span class="stringliteral">&quot; &lt;&lt;&lt;&lt;&lt;&lt;\n&quot;</span>));</div>
<div class="line"></div>
<div class="line">    TCHAR option[256];</div>
<div class="line">    acedGetKword(_T(<span class="stringliteral">&quot;\nEnter any key to create a line.&quot;</span>), option);</div>
<div class="line"></div>
<div class="line">    AcGePoint3d startPt(200 ,200, 0);</div>
<div class="line">    AcGePoint3d endPt(600, 200, 0);</div>
<div class="line">    AcDbLine *pLine = <span class="keyword">new</span> AcDbLine(startPt, endPt);</div>
<div class="line"></div>
<div class="line">    AcDbBlockTable *pBlockTable1;</div>
<div class="line">    acdbHostApplicationServices()-&gt;workingDatabase()-&gt;getSymbolTable(pBlockTable1, AcDb::kForRead);</div>
<div class="line"></div>
<div class="line">    AcDbBlockTableRecord *pBlockTableRecord1;</div>
<div class="line">    pBlockTable1-&gt;getAt(ACDB_MODEL_SPACE, pBlockTableRecord1, AcDb::kForWrite);</div>
<div class="line">    pBlockTable1-&gt;close();</div>
<div class="line"></div>
<div class="line">    AcDbObjectId lineId;</div>
<div class="line">    pBlockTableRecord1-&gt;appendAcDbEntity(lineId, pLine);</div>
<div class="line"></div>
<div class="line">    pBlockTableRecord1-&gt;close();</div>
<div class="line">    pLine-&gt;close();</div>
<div class="line"></div>
<div class="line">    actrTransactionManager</div>
<div class="line">        -&gt;addNewlyCreatedDBRObject(pLine);</div>
<div class="line">    pLine-&gt;draw();</div>
<div class="line">    acutPrintf(_T(<span class="stringliteral">&quot;\nCreated a Line &quot;</span>)</div>
<div class="line">        _T(<span class="stringliteral">&quot; the Line.&quot;</span>));</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    pTrans = actrTransactionManager-&gt;startTransaction();</div>
<div class="line">    assert(pTrans != NULL);</div>
<div class="line">    acutPrintf(_T(<span class="stringliteral">&quot;\n\n&gt;&gt;&gt;&gt;&gt;  Started transaction two.&quot;</span>)</div>
<div class="line">        _T(<span class="stringliteral">&quot; &lt;&lt;&lt;&lt;&lt;&lt;\n&quot;</span>));</div>
<div class="line"></div>
<div class="line">    acedGetKword(_T(<span class="stringliteral">&quot;\nEnter any key to create a Circle.&quot;</span>), option);</div>
<div class="line"></div>
<div class="line">    AcDbCircle* pCircle = <span class="keyword">new</span> AcDbCircle(AcGePoint3d(400,200,0),AcGeVector3d(0,0,1),200);</div>
<div class="line">    AcDbBlockTable *pBlockTable;</div>
<div class="line">    acdbHostApplicationServices()-&gt;workingDatabase()-&gt;getSymbolTable(pBlockTable, AcDb::kForRead);</div>
<div class="line"></div>
<div class="line">    AcDbBlockTableRecord *pBlockTableRecord;</div>
<div class="line">    pBlockTable-&gt;getAt(ACDB_MODEL_SPACE, pBlockTableRecord, AcDb::kForWrite);</div>
<div class="line">    pBlockTable-&gt;close();</div>
<div class="line"></div>
<div class="line">    AcDbObjectId circleId;</div>
<div class="line">    pBlockTableRecord-&gt;appendAcDbEntity(circleId, pCircle);</div>
<div class="line"></div>
<div class="line">    pBlockTableRecord-&gt;close();</div>
<div class="line">    pCircle-&gt;close();</div>
<div class="line"></div>
<div class="line">    actrTransactionManager</div>
<div class="line">        -&gt;addNewlyCreatedDBRObject(pCircle);</div>
<div class="line">    pCircle-&gt;draw();</div>
<div class="line">    acutPrintf(_T(<span class="stringliteral">&quot;\nCreated a Circle &quot;</span>)</div>
<div class="line">        _T(<span class="stringliteral">&quot; the Circle.&quot;</span>));</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    pTrans = actrTransactionManager-&gt;startTransaction();</div>
<div class="line">    assert(pTrans != NULL);</div>
<div class="line">    acutPrintf(_T(<span class="stringliteral">&quot;\n\n&gt;&gt;&gt;&gt;&gt;  Started transaction three.&quot;</span>)</div>
<div class="line">        _T(<span class="stringliteral">&quot; &lt;&lt;&lt;&lt;&lt;&lt;\n&quot;</span>));</div>
<div class="line"></div>
<div class="line">    acedGetKword(_T(<span class="stringliteral">&quot;\nEnter any key to create a text.&quot;</span>), option);</div>
<div class="line"></div>
<div class="line">    AcGePoint3d ptInsert(220, 200, 0);</div>
<div class="line">    <span class="keyword">const</span> ACHAR* text = _T(<span class="stringliteral">&quot;Hello World&quot;</span>);</div>
<div class="line">    AcDbObjectId style = AcDbObjectId::kNull;</div>
<div class="line">    <span class="keywordtype">double</span> height = 50;</div>
<div class="line">    <span class="keywordtype">double</span> rotation = 0;</div>
<div class="line">    AcDbText *pText = <span class="keyword">new</span> AcDbText(ptInsert, text, style, height, rotation);</div>
<div class="line"></div>
<div class="line">    AcDbBlockTable *pBlockTable2;</div>
<div class="line">    acdbHostApplicationServices()-&gt;workingDatabase()-&gt;getSymbolTable(pBlockTable2, AcDb::kForRead);</div>
<div class="line"></div>
<div class="line">    AcDbBlockTableRecord *pBlockTableRecord2;</div>
<div class="line">    pBlockTable2-&gt;getAt(ACDB_MODEL_SPACE, pBlockTableRecord2, AcDb::kForWrite);</div>
<div class="line">    pBlockTable2-&gt;close();</div>
<div class="line"></div>
<div class="line">    AcDbObjectId textId;</div>
<div class="line">    pBlockTableRecord2-&gt;appendAcDbEntity(textId, pText);</div>
<div class="line"></div>
<div class="line">    pBlockTableRecord2-&gt;close();</div>
<div class="line">    pText-&gt;close();</div>
<div class="line"></div>
<div class="line">    actrTransactionManager</div>
<div class="line">        -&gt;addNewlyCreatedDBRObject(pText);</div>
<div class="line">    pText-&gt;draw();</div>
<div class="line">    acutPrintf(_T(<span class="stringliteral">&quot;\nCreated a Text &quot;</span>)</div>
<div class="line">        _T(<span class="stringliteral">&quot; the Text.&quot;</span>));</div>
<div class="line"></div>
<div class="line">    Adesk::Boolean yes = Adesk::kTrue;</div>
<div class="line">    Adesk::Boolean interrupted;</div>
<div class="line">    yes = Adesk::kFalse;</div>
<div class="line">    <span class="keywordflow">if</span> (getYOrN(_T(<span class="stringliteral">&quot;\nAbort transaction three? &lt;No&gt; : &quot;</span>),</div>
<div class="line">        Adesk::kFalse, yes,interrupted) == Acad::eOk </div>
<div class="line">        &amp;&amp; yes == Adesk::kTrue)</div>
<div class="line">    {</div>
<div class="line">        acutPrintf(_T(<span class="stringliteral">&quot;\n\n@@@@@  Aborting transaction&quot;</span>)</div>
<div class="line">            _T(<span class="stringliteral">&quot; three. @@@@@\n&quot;</span>));</div>
<div class="line">        actrTransactionManager-&gt;abortTransaction();</div>
<div class="line">        acutPrintf(_T(<span class="stringliteral">&quot;\nBack to the circle and line.&quot;</span>));</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        acutPrintf(_T(<span class="stringliteral">&quot;\n\n&amp;&amp;&amp;&amp;&amp;  Ending transaction three.&quot;</span>)</div>
<div class="line">            _T(<span class="stringliteral">&quot; &amp;&amp;&amp;&amp;&amp;\n&quot;</span>));</div>
<div class="line">        actrTransactionManager-&gt;endTransaction();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    yes = Adesk::kFalse;</div>
<div class="line">    <span class="keywordflow">if</span> (getYOrN(_T(<span class="stringliteral">&quot;\nAbort transaction two? &lt;No&gt; : &quot;</span>),</div>
<div class="line">        Adesk::kFalse, yes,interrupted) == Acad::eOk </div>
<div class="line">        &amp;&amp; yes == Adesk::kTrue)</div>
<div class="line">    {</div>
<div class="line">        acutPrintf(_T(<span class="stringliteral">&quot;\n\n@@@@@  Aborting transaction two.&quot;</span>)</div>
<div class="line">            _T(<span class="stringliteral">&quot; @@@@@@\n&quot;</span>));</div>
<div class="line">        actrTransactionManager-&gt;abortTransaction();</div>
<div class="line">        acutPrintf(_T(<span class="stringliteral">&quot;\nBack to circle&quot;</span>));</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        acutPrintf(_T(<span class="stringliteral">&quot;\n\n&amp;&amp;&amp;&amp;&amp;  Ending transaction two.&quot;</span>)</div>
<div class="line">            _T(<span class="stringliteral">&quot; &amp;&amp;&amp;&amp;&amp;\n&quot;</span>));</div>
<div class="line">        actrTransactionManager-&gt;endTransaction();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    yes = Adesk::kFalse;</div>
<div class="line">    <span class="keywordflow">if</span> (getYOrN(_T(<span class="stringliteral">&quot;\nAbort transaction one? &lt;No&gt; : &quot;</span>),</div>
<div class="line">        Adesk::kFalse, yes,interrupted) == Acad::eOk </div>
<div class="line">        &amp;&amp; yes == Adesk::kTrue)</div>
<div class="line">    {</div>
<div class="line">        acutPrintf(_T(<span class="stringliteral">&quot;\n\n@@@@@  Aborting transaction one.&quot;</span>)</div>
<div class="line">            _T(<span class="stringliteral">&quot; @@@@@\n&quot;</span>));</div>
<div class="line">        actrTransactionManager-&gt;abortTransaction();</div>
<div class="line">        acutPrintf(_T(<span class="stringliteral">&quot;\nBack to nothing.&quot;</span>));</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        actrTransactionManager-&gt;endTransaction();</div>
<div class="line">        acutPrintf(_T(<span class="stringliteral">&quot;\n\n&amp;&amp;&amp;&amp;&amp;  Ending transaction one.&quot;</span>)</div>
<div class="line">            _T(<span class="stringliteral">&quot; &amp;&amp;&amp;&amp;&amp;\n&quot;</span>));</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<hr class="footer"/><address class="footer"><small>
<a href="https://www.zwsoft.com/zwcad/Developers/">
<img class="footer" src="zwsoft.png" alt="zwsoft"/></br>
</a>
&copy; 1998-2022  Copyright ZWSOFT CO., LTD(Guangzhou)</br>
All rights reserved.
</small></address>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ZWSoft ZRX for ZWCAD: Developer Guide: Input Point Monitors</title>
<link href="../styles/tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../scripts/jquery.js"></script>
<script type="text/javascript" src="../scripts/dynsections.js"></script>
<link href="../styles/doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../pics/logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ZWSoft ZRX for ZWCAD: Developer Guide
   &#160;<span id="projectnumber">2024</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Input Point Monitors<div class="ingroups"><a class="el" href="group___advanced_topics.html">Advanced Topics</a> &raquo; <a class="el" href="group___input_pnt_proc.html">Input Point Processing</a> &raquo; <a class="el" href="group___filtersand_monitors.html">Input Point Filters and Monitors</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="keyword">class </span>ZsdkInputPointMonitor : <span class="keyword">public</span> AcEdInputPointMonitor</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keyword">virtual</span> Acad::ErrorStatus </div><div class="line">        monitorInputPoint(<span class="keyword">const</span> AcEdInputPoint&amp; input, AcEdInputPointMonitorResult&amp; output);</div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">bool</span></div><div class="line">        excludeFromOsnapCalculation (<span class="keyword">const</span> AcArray&lt;AcDbObjectId&gt;&amp; nestedEntity,</div><div class="line">        Adesk::GsMarker gsSelectionMark);</div><div class="line">};</div></div><!-- fragment --><p>The following example demonstrates creating a input point monitor. <br />
 Warning : There are some related interfaces are not implemented so this feature is temporarily unavailable. </p><div class="fragment"><div class="line">Acad::ErrorStatus </div><div class="line">    ZsdkInputPointMonitor::monitorInputPoint(<span class="keyword">const</span> AcEdInputPoint&amp; input, AcEdInputPointMonitorResult&amp; output)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> ( !input.pointComputed() )  </div><div class="line">    {  </div><div class="line">        <span class="comment">// Points cannot be computed in the Monitor  </span></div><div class="line">        <span class="comment">// Forced picking may be enabled  </span></div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> ( input.history() &amp; Acad::eCyclingPt)  </div><div class="line">            acutPrintf( _T(<span class="stringliteral">&quot;\nNo point computed, but new cycling osnap: %.2f, %.2f, %.2f\n&quot;</span>),  </div><div class="line">            input.osnappedPoint()[X], input.osnappedPoint()[Y], input.osnappedPoint()[Z] );  </div><div class="line"></div><div class="line">        <span class="keywordflow">return</span> Acad::eOk;  </div><div class="line">    }  </div><div class="line"></div><div class="line">    <span class="comment">// Show historical point selection information  </span></div><div class="line">    <span class="comment">//  </span></div><div class="line"><span class="preprocessor">#define HISTORY_CHECK(x)  if (input.history() &amp; Acad:: ## x) acutPrintf(_T(&quot;%s &quot;), _T(#x))  </span></div><div class="line"></div><div class="line">    acutPrintf( _T(<span class="stringliteral">&quot;\nHistory: %d, &quot;</span>), input.history() );  </div><div class="line"></div><div class="line">    HISTORY_CHECK(eTablet);  </div><div class="line">    HISTORY_CHECK(eNotDigitizer);  </div><div class="line">    HISTORY_CHECK(eLastPt);  </div><div class="line">    HISTORY_CHECK(eGripped);  </div><div class="line">    HISTORY_CHECK(eCartSnapped);  </div><div class="line">    HISTORY_CHECK(eOrtho);  </div><div class="line">    HISTORY_CHECK(eCyclingPt);  </div><div class="line">    HISTORY_CHECK(eOsnapped);  </div><div class="line">    HISTORY_CHECK(ePolarAngle);  </div><div class="line">    HISTORY_CHECK(eAligned);  </div><div class="line">    HISTORY_CHECK(eAppFiltered);  </div><div class="line">    HISTORY_CHECK(eForcedPick);  </div><div class="line">    HISTORY_CHECK(ePickMask);  </div><div class="line">    HISTORY_CHECK(eDidNotPick);  </div><div class="line">    HISTORY_CHECK(eUsedPickBox);  </div><div class="line">    HISTORY_CHECK(eUsedOsnapBox);  </div><div class="line">    HISTORY_CHECK(ePickAborted);  </div><div class="line">    HISTORY_CHECK(eXPending);  </div><div class="line">    HISTORY_CHECK(eYPending);  </div><div class="line">    HISTORY_CHECK(eZPending);  </div><div class="line">    HISTORY_CHECK(eCoordPending);  </div><div class="line"></div><div class="line"><span class="preprocessor">#undef HISTORY_CHECK  </span></div><div class="line"></div><div class="line">    acutPrintf( _T(<span class="stringliteral">&quot;\n&quot;</span>) );  </div><div class="line"></div><div class="line">    <span class="comment">// Show more point input information  </span></div><div class="line">    <span class="comment">//  </span></div><div class="line">    <span class="keywordflow">if</span> ( input.history() &amp; Acad::eLastPt )  </div><div class="line">        acutPrintf( _T(<span class="stringliteral">&quot;Last point:              %.2f, %.2f, %.2f\n&quot;</span>), input.lastPoint()[X], input.lastPoint()[Y], input.lastPoint()[Z] );  </div><div class="line"></div><div class="line">    acutPrintf( _T(<span class="stringliteral">&quot;Raw point:               %.2f, %.2f, %.2f\n&quot;</span>), input.rawPoint()[X], input.rawPoint()[Y], input.rawPoint()[Z] );  </div><div class="line">    acutPrintf( _T(<span class="stringliteral">&quot;Computed point:          %.2f, %.2f, %.2f\n&quot;</span>), input.computedPoint()[X], input.computedPoint()[Y], input.computedPoint()[Z] );  </div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> ( input.history() &amp; Acad::eGripped )  </div><div class="line">        acutPrintf( _T(<span class="stringliteral">&quot;Gripped point:           %.2f, %.2f, %.2f\n&quot;</span>), input.grippedPoint()[X], input.grippedPoint()[Y], input.grippedPoint()[Z] );  </div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> ( input.history() &amp; Acad::eCartSnapped )  </div><div class="line">        acutPrintf( _T(<span class="stringliteral">&quot;Cartesian snapped point: %.2f, %.2f, %.2f\n&quot;</span>), input.cartesianSnappedPoint()[X], input.cartesianSnappedPoint()[Y], input.cartesianSnappedPoint()[Z] );  </div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> ( input.history() &amp; Acad::eOsnapped )  </div><div class="line">    {  </div><div class="line">        acutPrintf( _T(<span class="stringliteral">&quot;Osnapped point:          %.2f, %.2f, %.2f\n&quot;</span>), input.osnappedPoint()[X], input.osnappedPoint()[Y], input.osnappedPoint()[Z] );  </div><div class="line"></div><div class="line">        acutPrintf( _T(<span class="stringliteral">&quot;Object snap masks: &quot;</span>) );  </div><div class="line"></div><div class="line"><span class="preprocessor">#define OSMASK_CHECK(x)  if (input.osnapMask() &amp; AcDb:: ## x) acutPrintf(_T(&quot;%s &quot;), _T(#x))  </span></div><div class="line"></div><div class="line">        OSMASK_CHECK(kOsMaskEnd);  </div><div class="line">        OSMASK_CHECK(kOsMaskMid);  </div><div class="line">        OSMASK_CHECK(kOsMaskCen);  </div><div class="line">        OSMASK_CHECK(kOsMaskNode);  </div><div class="line">        OSMASK_CHECK(kOsMaskQuad);  </div><div class="line">        OSMASK_CHECK(kOsMaskInt);  </div><div class="line">        OSMASK_CHECK(kOsMaskIns);  </div><div class="line">        OSMASK_CHECK(kOsMaskPerp);  </div><div class="line">        OSMASK_CHECK(kOsMaskTan);  </div><div class="line">        OSMASK_CHECK(kOsMaskNear);  </div><div class="line">        OSMASK_CHECK(kOsMaskQuick);  </div><div class="line">        OSMASK_CHECK(kOsMaskApint);  </div><div class="line">        OSMASK_CHECK(kOsMaskImmediate);  </div><div class="line">        OSMASK_CHECK(kOsMaskAllowTan);  </div><div class="line">        OSMASK_CHECK(kOsMaskDisablePerp);  </div><div class="line">        OSMASK_CHECK(kOsMaskRelCartesian);  </div><div class="line">        OSMASK_CHECK(kOsMaskRelPolar);  </div><div class="line"></div><div class="line"><span class="preprocessor">#undef OSMASK_CHECK  </span></div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> ( 0 == input.osnapMask() )  </div><div class="line">        {  </div><div class="line">            <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; input.customOsnapModes().length(); i++ )  </div><div class="line">                acutPrintf( _T(<span class="stringliteral">&quot;%s\n&quot;</span>), input.customOsnapModes()[i]-&gt;globalModeString() );  </div><div class="line">        }  </div><div class="line">        acutPrintf( _T(<span class="stringliteral">&quot;\n&quot;</span>) );  </div><div class="line">    }  </div><div class="line"></div><div class="line">    <span class="comment">// Show the object snap overrides  </span></div><div class="line">    <span class="comment">//  </span></div><div class="line">    <span class="keywordflow">if</span> ( 0 != input.osnapOverrides() )  </div><div class="line">    {  </div><div class="line"></div><div class="line">        acutPrintf( _T(<span class="stringliteral">&quot;Object snap overrides: &quot;</span>) );  </div><div class="line"></div><div class="line"><span class="preprocessor">#define OSMASK_CHECK(x)  if (input.osnapOverrides() &amp; AcDb:: ## x) acutPrintf(_T(&quot;%s &quot;), _T(#x))  </span></div><div class="line"></div><div class="line">        OSMASK_CHECK(kOsMaskEnd);  </div><div class="line">        OSMASK_CHECK(kOsMaskMid);  </div><div class="line">        OSMASK_CHECK(kOsMaskCen);  </div><div class="line">        OSMASK_CHECK(kOsMaskNode);  </div><div class="line">        OSMASK_CHECK(kOsMaskQuad);  </div><div class="line">        OSMASK_CHECK(kOsMaskInt);  </div><div class="line">        OSMASK_CHECK(kOsMaskIns);  </div><div class="line">        OSMASK_CHECK(kOsMaskPerp);  </div><div class="line">        OSMASK_CHECK(kOsMaskTan);  </div><div class="line">        OSMASK_CHECK(kOsMaskNear);  </div><div class="line">        OSMASK_CHECK(kOsMaskQuick);  </div><div class="line">        OSMASK_CHECK(kOsMaskApint);  </div><div class="line">        OSMASK_CHECK(kOsMaskImmediate);  </div><div class="line">        OSMASK_CHECK(kOsMaskAllowTan);  </div><div class="line">        OSMASK_CHECK(kOsMaskDisablePerp);  </div><div class="line">        OSMASK_CHECK(kOsMaskRelCartesian);  </div><div class="line">        OSMASK_CHECK(kOsMaskRelPolar);  </div><div class="line"></div><div class="line"><span class="preprocessor">#undef OSMASK_CHECK  </span></div><div class="line"></div><div class="line">        acutPrintf(_T(<span class="stringliteral">&quot;\n&quot;</span>));  </div><div class="line">    }  </div><div class="line"></div><div class="line">    <span class="comment">// Show custom object snap overrides  </span></div><div class="line">    <span class="comment">//  </span></div><div class="line">    <span class="keywordflow">if</span> ( 0 != input.customOsnapOverrides().length() )  </div><div class="line">    {  </div><div class="line">        acutPrintf( _T(<span class="stringliteral">&quot;Custom object snap overrides: &quot;</span>) );  </div><div class="line">        <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> x = 0; x &lt; input.customOsnapOverrides().length(); x++)  </div><div class="line">            acutPrintf( _T(<span class="stringliteral">&quot;%s &quot;</span>), input.customOsnapOverrides()[x]-&gt;globalModeString() );  </div><div class="line">        acutPrintf( _T(<span class="stringliteral">&quot;\n&quot;</span>) );  </div><div class="line">    }  </div><div class="line"></div><div class="line">    <span class="comment">// Show object snap or forced pick information: the entities in the aperture  </span></div><div class="line">    acutPrintf( _T(<span class="stringliteral">&quot;%d apertured entities, &quot;</span>), input.pickedEntities().length() );  </div><div class="line">    acutPrintf( _T(<span class="stringliteral">&quot;%d nested apertured entities\n&quot;</span>), input.nestedPickedEntities().length() );  </div><div class="line"></div><div class="line">    <span class="comment">// Show AutoSnap information  </span></div><div class="line">    <span class="comment">// Note: nestedKeyPointEntities.length() == keyPointGsSelectionMark.length()  </span></div><div class="line">    <span class="comment">//  </span></div><div class="line">    acutPrintf( _T(<span class="stringliteral">&quot;%d key point entities, &quot;</span>), input.keyPointEntities().length() );  </div><div class="line">    acutPrintf( _T(<span class="stringliteral">&quot;%d nested key point entities\n&quot;</span>), input.nestedKeyPointEntities().length() );  </div><div class="line">    acutPrintf( _T(<span class="stringliteral">&quot;%d alignment paths\n&quot;</span>), input.alignmentPaths().length() );  </div><div class="line"></div><div class="line">    <span class="comment">// Add an additional comment to the tootip string  </span></div><div class="line">    <span class="comment">//  </span></div><div class="line">    <span class="keywordflow">if</span> ( NULL != input.tooltipString() )  </div><div class="line">    {  </div><div class="line">        output.setAdditionalTooltipString(_T(<span class="stringliteral">&quot;, Additional comment!&quot;</span>));  </div><div class="line">        acutPrintf( _T(<span class="stringliteral">&quot;Appending \&quot;%s\&quot; to \&quot;%s\&quot;\n&quot;</span>), _T(<span class="stringliteral">&quot;, Additional comment!&quot;</span>), input.tooltipString() );  </div><div class="line">    }  </div><div class="line">    <span class="keywordflow">else</span>  </div><div class="line">        acutPrintf( _T(<span class="stringliteral">&quot;Tooltip is NULL\n&quot;</span>) );  </div><div class="line"></div><div class="line">    acedPostCommandPrompt();  </div><div class="line">    <span class="keywordflow">return</span> Acad::eOk;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">bool</span>  </div><div class="line">    ZsdkInputPointMonitor::excludeFromOsnapCalculation (<span class="keyword">const</span> AcArray&lt;AcDbObjectId&gt;&amp; nestedEntity, INT_PTR gsSelectionMark)  </div><div class="line">{  </div><div class="line">    acutPrintf( _T(<span class="stringliteral">&quot;\nExcludeFromOsnapCalculation called on monitor...\n&quot;</span>) );  </div><div class="line">    acutPrintf( _T(<span class="stringliteral">&quot;%d nested entities under cursor\n&quot;</span>), nestedEntity.length() );  </div><div class="line">    <span class="keywordflow">return</span> <span class="keyword">false</span>;  </div><div class="line">}  </div><div class="line"><span class="comment">// Input point monitor</span></div><div class="line">ZsdkInputPointMonitor my_InputPointMonitor;</div><div class="line"></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="keywordtype">void</span> testipm()</div><div class="line">{</div><div class="line">    curDoc()-&gt;inputPointManager()-&gt;addPointMonitor(&amp;my_InputPointMonitor);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> __declspec(dllexport)</div><div class="line">    AcRx::AppRetCode </div><div class="line">    zcrxEntryPoint(AcRx::AppMsgCode msg, <span class="keywordtype">void</span> *p)</div><div class="line">{</div><div class="line">    <span class="keywordflow">switch</span> (msg)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> AcRx::kInitAppMsg:</div><div class="line">        acrxRegisterAppMDIAware(p);</div><div class="line">        acrxUnlockApplication(p);</div><div class="line">        acedRegCmds-&gt;addCommand(TEXT(<span class="stringliteral">&quot;testipm&quot;</span>), TEXT(<span class="stringliteral">&quot;testipm&quot;</span>), TEXT(<span class="stringliteral">&quot;testipm&quot;</span>),</div><div class="line">            ACRX_CMD_TRANSPARENT, testipm);</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    <span class="keywordflow">case</span> AcRx::kUnloadAppMsg:</div><div class="line">        acedRegCmds-&gt;removeGroup(TEXT(<span class="stringliteral">&quot;testipm&quot;</span>));</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> AcRx::kRetOK;</div><div class="line">}</div></div><!-- fragment --> </div><!-- contents -->
<hr class="footer"/><address class="footer"><small>
<a href="https://www.zwsoft.com/zwcad/Developers/">
<img class="footer" src="../pics/zwsoft.png" alt="zwsoft"/></br>
</a>
&copy; 1998-2023  Copyright ZWSOFT CO., LTD(Guangzhou)</br>
All rights reserved.
</small></address>
</body>
</html>



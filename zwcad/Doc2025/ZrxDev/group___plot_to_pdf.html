<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ZWSoft ZRX for ZWCAD: Developer Guide: Plot to a File</title>
<link href="../styles/tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../scripts/jquery.js"></script>
<script type="text/javascript" src="../scripts/dynsections.js"></script>
<link href="../styles/doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../pics/logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ZWSoft ZRX for ZWCAD: Developer Guide
   &#160;<span id="projectnumber">2024</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Plot to a File<div class="ingroups"><a class="el" href="group___basic_interaction.html">Basic Interaction with ZWCAD</a> &raquo; <a class="el" href="group___plot_a_p_i.html">Plot API</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<p>ZRX Application provide the plot method to outpout the image file. <br />
 By using the series of "plot" functons, user can set what to plot, such as which layer; and use which print device to plot. <br />
 This example shows: how to plot the image of current database to a pdf file. <br />
 1. Using "createPublishEngine" to create a engine for plotting. <br />
 2. Getting the actived layer of current database. <br />
 3. Using "plotSettingsValidator" to get the pointer of plotsetting. <br />
 4. Using "setPlotCfgName" to select "DWG To PDF.pc5" as the printer to output the pdf file. And user can change other printer device in system. <br />
 5. Using "setCanonicalMediaName" to select "ISO_A4_(210.00_x_297.00_MM)" as the A4 media. <br />
 6. Using "setPlotCentered" to print the image in the center of the media. <br />
 7. Using "beginPlot" to send command to the plot engine for plotting. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> CPlotFile::PlotToPdf()</div><div class="line">{</div><div class="line">    AcPlPlotEngine* PlotEngine = NULL;</div><div class="line">    AcDbPlotSettingsValidator* PlotSettingsValidator = NULL;</div><div class="line">    Acad::ErrorStatus es = Acad::eOk;</div><div class="line">    AcDbObjectId ObjectId=AcDbObjectId::kNull;</div><div class="line">    es = AcPlPlotFactory::createPublishEngine(PlotEngine);</div><div class="line">    <span class="keywordflow">if</span>(Acad::eOk == es &amp;&amp; PlotEngine)</div><div class="line">    {</div><div class="line">        AcPlPlotPageInfo PlotPageInfo;</div><div class="line">        AcPlPlotInfo PlotInfo; </div><div class="line">        AcDbLayout* Layout = NULL;</div><div class="line">        AcDbPlotSettings* PlotSettings=NULL;</div><div class="line">        AcDbLayoutManager* LayoutManager = acdbHostApplicationServices()-&gt;layoutManager(); </div><div class="line">        AcDbObjectId ObjectId = LayoutManager-&gt;getActiveLayoutBTRId();</div><div class="line">        AcDbBlockTableRecord* BlockTableRecord;</div><div class="line">        es = acdbOpenObject(BlockTableRecord, ObjectId, AcDb::kForRead);</div><div class="line">        ObjectId = BlockTableRecord-&gt;getLayoutId();</div><div class="line">        es = acdbOpenObject(Layout, ObjectId, AcDb::kForWrite);</div><div class="line"></div><div class="line">        PlotSettings=<span class="keyword">new</span> AcDbPlotSettings(Layout-&gt;modelType());</div><div class="line">        PlotSettings-&gt;copyFrom(Layout);</div><div class="line">        Layout-&gt;close();</div><div class="line">        BlockTableRecord-&gt;close();</div><div class="line"></div><div class="line">        PlotSettingsValidator = (AcDbPlotSettingsValidator*)acdbHostApplicationServices()-&gt;plotSettingsValidator(); </div><div class="line">        PlotSettingsValidator-&gt;setPlotCfgName(PlotSettings, _T(<span class="stringliteral">&quot;DWG To PDF.pc5&quot;</span>));</div><div class="line">        PlotSettingsValidator-&gt;refreshLists(PlotSettings);</div><div class="line">        PlotSettingsValidator-&gt;setCanonicalMediaName(PlotSettings, _T(<span class="stringliteral">&quot;ISO_A4_(210.00_x_297.00_MM)&quot;</span>));</div><div class="line"></div><div class="line">        PlotSettingsValidator-&gt;setUseStandardScale(PlotSettings, Adesk::kTrue);</div><div class="line">        PlotSettingsValidator-&gt;setStdScaleType(PlotSettings, AcDbPlotSettings::kScaleToFit);</div><div class="line">        PlotSettingsValidator-&gt;setPlotType(PlotSettings, AcDbPlotSettings::kExtents);</div><div class="line">        PlotSettingsValidator-&gt;setPlotCentered(PlotSettings, <span class="keyword">true</span>);</div><div class="line"></div><div class="line">        PlotInfo.setLayout(ObjectId);</div><div class="line">        PlotInfo.setOverrideSettings(PlotSettings);</div><div class="line"></div><div class="line">        AcPlPlotInfoValidator validator;</div><div class="line">        validator.setMediaMatchingPolicy(AcPlPlotInfoValidator::MatchingPolicy::kMatchEnabled);</div><div class="line">        es = validator.validate(PlotInfo);</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (es == Acad::eOk)</div><div class="line">        {</div><div class="line">            <span class="keyword">const</span> ACHAR* fileName=acDocManager-&gt;curDocument()-&gt;fileName();</div><div class="line">            PlotEngine-&gt;beginPlot(NULL);</div><div class="line">            PlotEngine-&gt;beginDocument(PlotInfo, fileName, NULL, 1, <span class="keyword">true</span>, _T(<span class="stringliteral">&quot;Drawing1.pdf&quot;</span>));</div><div class="line">            PlotEngine-&gt;beginPage(PlotPageInfo, PlotInfo, <span class="keyword">true</span>);</div><div class="line">            PlotEngine-&gt;beginGenerateGraphics();</div><div class="line">            PlotEngine-&gt;endGenerateGraphics();</div><div class="line">            PlotEngine-&gt;endPage();</div><div class="line">            PlotEngine-&gt;endDocument();</div><div class="line">            PlotEngine-&gt;endPlot();</div><div class="line">        }</div><div class="line"></div><div class="line">        PlotEngine-&gt;destroy();</div><div class="line">        PlotEngine = NULL;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        acedAlert(_T(<span class="stringliteral">&quot;createPublishEngine fail&quot;</span>));</div><div class="line">    }</div><div class="line">}</div><div class="line"></div></div><!-- fragment --> </div><!-- contents -->
<hr class="footer"/><address class="footer"><small>
<a href="https://www.zwsoft.com/zwcad/Developers/">
<img class="footer" src="../pics/zwsoft.png" alt="zwsoft"/></br>
</a>
&copy; 1998-2023  Copyright ZWSOFT CO., LTD(Guangzhou)</br>
All rights reserved.
</small></address>
</body>
</html>



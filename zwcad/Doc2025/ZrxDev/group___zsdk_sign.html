<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ZWSoft ZRX for ZWCAD: Developer Guide: ZsdkSign</title>
<link href="../styles/tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../scripts/jquery.js"></script>
<script type="text/javascript" src="../scripts/dynsections.js"></script>
<link href="../styles/doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../pics/logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ZWSoft ZRX for ZWCAD: Developer Guide
   &#160;<span id="projectnumber">2024</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">ZsdkSign<div class="ingroups"><a class="el" href="group___custom_obj.html">Custom Objects</a> &raquo; <a class="el" href="group___der_ac_db_ent.html">Deriving from AcDbEntity</a> &raquo; <a class="el" href="group___custom_entity_d_b.html">Custom Entity Data Base</a> &raquo; <a class="el" href="group___source_file_ent.html">Source File</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<p>The following code shows the implementation for the new class ZsdkSign: </p><div class="fragment"><div class="line">ACRX_DXF_DEFINE_MEMBERS(ZsdkSign, AcDbEntity,</div><div class="line">                        AcDb::kDHL_CURRENT, AcDb::kMReleaseCurrent,</div><div class="line">                        AcDbProxyEntity::kTransformAllowed |</div><div class="line">                        AcDbProxyEntity::kColorChangeAllowed |</div><div class="line">                        AcDbProxyEntity::kLayerChangeAllowed,</div><div class="line">                        ZSDKSIGN, SignDb|Product: ZRX Enabler <span class="keywordflow">for</span> Sign Entity|Company: ZWSOFT|Website: www.zwcad.com</div><div class="line">                        );</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keywordtype">double</span> kCurrentVersionNumber = 1.0;</div><div class="line"></div><div class="line"><span class="keywordtype">bool</span> ZsdkSign::s_bHasClsid = <span class="keyword">false</span>;</div><div class="line">CLSID ZsdkSign::s_clsid;</div><div class="line"></div><div class="line">ZsdkSign::ZsdkSign(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    mNormal = AcGeVector3d::kZAxis;</div><div class="line">    mCenter = AcGePoint3d::kOrigin;</div><div class="line">    mRadius = 10;</div><div class="line">    mTextColor.setRGB(255, 255, 0);</div><div class="line">    mText = _T(<span class="stringliteral">&quot;A&quot;</span>);</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line">ZsdkSign::~ZsdkSign(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">}</div><div class="line"></div><div class="line">Acad::ErrorStatus ZsdkSign::dwgInFields(AcDbDwgFiler* filer)</div><div class="line">{</div><div class="line">    assertWriteEnabled();</div><div class="line">    AcDbEntity::dwgInFields(filer);</div><div class="line">    <span class="comment">// Read version number</span></div><div class="line">    <span class="keywordtype">double</span> version;</div><div class="line">    filer-&gt;readItem(&amp;version);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (version &gt; kCurrentVersionNumber)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> Acad::eMakeMeProxy;</div><div class="line">    }</div><div class="line"></div><div class="line">    filer-&gt;readItem(&amp;mNormal);</div><div class="line">    filer-&gt;readItem(&amp;mCenter);</div><div class="line">    filer-&gt;readItem(&amp;mRadius);</div><div class="line">    Adesk::UInt32 color;</div><div class="line">    filer-&gt;readUInt32(&amp;color);</div><div class="line">    mTextColor.setColor(color);</div><div class="line">    ACHAR* pszBuf = NULL;</div><div class="line">    filer-&gt;readString(&amp;pszBuf);</div><div class="line">    setText(AcString(pszBuf));</div><div class="line">    delString(pszBuf);</div><div class="line"></div><div class="line">    AcGeScale3d sc;</div><div class="line">    filer-&gt;readScale3d(&amp;sc);</div><div class="line">    filer-&gt;readItem(&amp;sc);</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> filer-&gt;filerStatus();</div><div class="line">}</div><div class="line"></div><div class="line">Acad::ErrorStatus ZsdkSign::dwgOutFields(AcDbDwgFiler* filer)<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">    assertReadEnabled();</div><div class="line">    AcDbEntity::dwgOutFields(filer);</div><div class="line">    filer-&gt;writeItem(kCurrentVersionNumber);</div><div class="line">    filer-&gt;writeItem(mNormal);</div><div class="line">    filer-&gt;writeItem(mCenter);</div><div class="line">    filer-&gt;writeItem(mRadius);</div><div class="line">    filer-&gt;writeItem(mTextColor.color());</div><div class="line">    filer-&gt;writeString((LPCTSTR)mText);</div><div class="line"></div><div class="line">    AcGeScale3d sc(0.5);</div><div class="line">    filer-&gt;writeScale3d(sc);</div><div class="line">    filer-&gt;writeItem(sc);</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> filer-&gt;filerStatus();</div><div class="line">}</div><div class="line"></div><div class="line">Acad::ErrorStatus ZsdkSign::dxfInFields(AcDbDxfFiler* filer)</div><div class="line">{</div><div class="line">    assertWriteEnabled();</div><div class="line"></div><div class="line">    <span class="keyword">struct </span>resbuf rb;</div><div class="line">    AcGePoint3d center, mouthleftpt, mouthbottompt, mouthrightpt;</div><div class="line">    <span class="keywordtype">double</span> radius;</div><div class="line"></div><div class="line">    Acad::ErrorStatus es = AcDbEntity::dxfInFields( filer );</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span>( Acad::eOk != es ) {</div><div class="line">        <span class="keywordflow">return</span> es;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Check that we are at the correct subclass data</span></div><div class="line">    <span class="comment">//</span></div><div class="line">    <span class="keywordflow">if</span>( !filer-&gt;atSubclassData( _T(<span class="stringliteral">&quot;ZsdkSign&quot;</span>) ))</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> Acad::eBadDxfSequence;</div><div class="line">    }</div><div class="line">    <span class="comment">// First piece of data MUST be the version number</span></div><div class="line">    <span class="keywordflow">if</span>( Acad::eOk != ( es = filer-&gt;readItem( &amp;rb )))</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> es;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> ( AcDb::kDxfReal != rb.restype )</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> Acad::eMakeMeProxy;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Check version first</span></div><div class="line">    <span class="keywordflow">if</span> ( rb.resval.rreal &gt; 1.0 )</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> Acad::eMakeMeProxy;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Set the normal&#39;s default value in case it&#39;s not in the</span></div><div class="line">    <span class="comment">// DXF information coming in</span></div><div class="line">    <span class="comment">//</span></div><div class="line">    mNormal = AcGeVector3d( 0, 0, 1 ); <span class="comment">// set default value:</span></div><div class="line"></div><div class="line">    <span class="keywordflow">while</span>( Acad::eOk == es ) {</div><div class="line">        <span class="keywordflow">if</span>( Acad::eOk == ( es = filer-&gt;readItem( &amp;rb ))) {</div><div class="line">            <span class="keywordflow">switch</span>( rb.restype ) {</div><div class="line">            <span class="keywordflow">case</span> AcDb::kDxfXCoord:</div><div class="line">                center.set( rb.resval.rpoint[X],</div><div class="line">                    rb.resval.rpoint[Y],</div><div class="line">                    rb.resval.rpoint[Z]);</div><div class="line">                setCenter( center );</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            <span class="keywordflow">case</span> AcDb::kDxfReal+1:</div><div class="line">                radius = rb.resval.rreal;</div><div class="line">                setRadius( radius );</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            <span class="keywordflow">case</span> AcDb::kDxfNormalX:</div><div class="line">                mNormal.set( rb.resval.rpoint[X],</div><div class="line">                    rb.resval.rpoint[Y],</div><div class="line">                    rb.resval.rpoint[Z]);</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            <span class="keywordflow">case</span> AcDb::kDxfColor:</div><div class="line">                {</div><div class="line">                    filer-&gt;pushBackItem();</div><div class="line">                    AcCmColor col;</div><div class="line">                    col.dxfIn(filer);</div><div class="line">                    setColor(col);</div><div class="line">                }</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            <span class="keywordflow">case</span> AcDb::kDxfText:</div><div class="line">                setText(AcString(rb.resval.rstring));</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> filer-&gt;filerStatus();</div><div class="line">}</div><div class="line"></div><div class="line">Acad::ErrorStatus ZsdkSign::dxfOutFields(AcDbDxfFiler* filer)<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">    assertReadEnabled();</div><div class="line"></div><div class="line">    AcDbEntity::dxfOutFields( filer );</div><div class="line"></div><div class="line">    filer-&gt;writeItem( AcDb::kDxfSubclass, _T(<span class="stringliteral">&quot;ZsdkSign&quot;</span>) );</div><div class="line">    <span class="comment">// Write version number</span></div><div class="line">    filer-&gt;writeItem( AcDb::kDxfReal, kCurrentVersionNumber );</div><div class="line">    filer-&gt;writeItem( AcDb::kDxfXCoord, center() );</div><div class="line">    filer-&gt;writeItem( AcDb::kDxfReal+1, radius() );</div><div class="line">    <span class="keywordflow">if</span>( filer-&gt;includesDefaultValues()</div><div class="line">        || mNormal != AcGeVector3d( 0, 0, 1 ))</div><div class="line">    {</div><div class="line">        filer-&gt;writeItem( AcDb::kDxfNormalX, mNormal );</div><div class="line">    }</div><div class="line">    AcCmColor col = textTrueColor();</div><div class="line">    col.dxfOut( filer );</div><div class="line">    filer-&gt;writeString( AcDb::kDxfText, (LPCTSTR)mText );</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> filer-&gt;filerStatus();</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">bool</span> funGripViewportDraw(ZcDbGripData* pThis, ZcGiViewportDraw* pWd,</div><div class="line">                         <span class="keyword">const</span> ZcDbObjectId&amp; entId, ZcDbGripOperations::DrawType type,</div><div class="line">                         ZcGePoint3d* imageGripPoint, <span class="keywordtype">int</span> gripSize)</div><div class="line">{</div><div class="line">    <span class="comment">// Use this as a reference point to draw the custom grip</span></div><div class="line">    AcGePoint3d pt = pThis-&gt;gripPoint();</div><div class="line">    <span class="comment">// Get the number of pixels per unit square</span></div><div class="line">    AcGePoint2d pixelArea;</div><div class="line"></div><div class="line">    pWd-&gt;viewport().getNumPixelsInUnitSquare(pt, pixelArea);</div><div class="line"></div><div class="line">    <span class="keywordtype">double</span> gripWidth = 2.0 / pixelArea.x;</div><div class="line"></div><div class="line">    <span class="keywordtype">double</span> offset = (gripSize * pixelArea.x) * 2.0;</div><div class="line">    <span class="comment">// To draw the graphics use the various geometry methods</span></div><div class="line">    <span class="comment">// To set attributes, acess the pVD-&gt;subEntityTraits()</span></div><div class="line">    <span class="comment">//pWd-&gt;subEntityTraits().setColor(kYellow);</span></div><div class="line"></div><div class="line">    <span class="comment">// Draw the grip</span></div><div class="line">    AcGePoint3d pts[4]; </div><div class="line">    pts[0] = pt + AcGeVector3d(-1-offset,-1-offset,0);</div><div class="line">    pts[1] = pt + AcGeVector3d(1+offset,-1-offset,0); </div><div class="line">    pts[2] = pt + AcGeVector3d(1+offset,1+offset,0);</div><div class="line">    pts[3] = pt + AcGeVector3d(-1-offset,1+offset,0);</div><div class="line"></div><div class="line">    pWd-&gt;geometry().polygonEye(4,pts);</div><div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">}</div><div class="line"><span class="keywordtype">bool</span> funGripWorldDraw(AcDbGripData* pThis, AcGiWorldDraw* pWd,</div><div class="line">                      <span class="keyword">const</span> AcDbObjectId&amp; entId, AcDbGripOperations::DrawType type,</div><div class="line">                      AcGePoint3d* imageGripPoint, <span class="keywordtype">double</span> dGripSize)</div><div class="line">{</div><div class="line">    AcGePoint3d pt = pThis-&gt;gripPoint();</div><div class="line"></div><div class="line">    <span class="comment">// Draw the grip</span></div><div class="line">    AcGePoint3d pts[4]; </div><div class="line">    pts[0] = pt + AcGeVector3d(-1,-1,0) * dGripSize;</div><div class="line">    pts[1] = pt + AcGeVector3d(1,-1,0)* dGripSize; </div><div class="line">    pts[2] = pt + AcGeVector3d(1,1,0)* dGripSize;</div><div class="line">    pts[3] = pt + AcGeVector3d(-1,1,0)* dGripSize;</div><div class="line">    pWd-&gt;geometry().polygon(4,pts);</div><div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">}</div><div class="line">Acad::ErrorStatus ZsdkSign::subGetGripPoints(AcDbGripDataPtrArray&amp; grips,</div><div class="line">                                          <span class="keyword">const</span> <span class="keywordtype">double</span> curViewUnitSize, <span class="keyword">const</span> <span class="keywordtype">int</span> gripSize, </div><div class="line">                                          <span class="keyword">const</span> AcGeVector3d&amp; curViewDir, <span class="keyword">const</span> <span class="keywordtype">int</span> bitflags)<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">    AcGePoint3dArray gripPoints;</div><div class="line">    AcGePoint3d cen( center() );</div><div class="line"></div><div class="line">    AcGeVector3d xoff( radius(), 0, 0 );</div><div class="line">    AcGeVector3d yoff( 0, radius(), 0 );</div><div class="line">    gripPoints.append( cen + xoff );</div><div class="line">    gripPoints.append( cen + yoff );</div><div class="line">    gripPoints.append( cen - xoff );</div><div class="line">    gripPoints.append( cen - yoff );</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0;i&lt;gripPoints.length(); i++)</div><div class="line">    {</div><div class="line">        AcDbGripData* gdtemp = <span class="keyword">new</span> AcDbGripData;</div><div class="line">        gdtemp-&gt;setGripPoint(gripPoints[i]);</div><div class="line">        gdtemp-&gt;setWorldDraw((GripWorldDrawPtr)funGripWorldDraw);</div><div class="line">        <span class="comment">//gdtemp-&gt;setViewportDraw((GripViewportDrawPtr)funGripViewportDraw);</span></div><div class="line">        grips.append(gdtemp);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> eOk;</div><div class="line">}</div><div class="line">Adesk::Boolean ZsdkSign::subWorldDraw(AcGiWorldDraw* wd)</div><div class="line">{</div><div class="line">    assertReadEnabled();</div><div class="line"></div><div class="line">    AcGiRegenType  test = wd-&gt;regenType();</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (objectId().isValid())</div><div class="line">    {</div><div class="line">        acutPrintf(_T(<span class="stringliteral">&quot;\nWorldDraw is called.&quot;</span>));</div><div class="line">    }</div><div class="line"></div><div class="line">    wd-&gt;subEntityTraits().setTrueColor(entityColor());</div><div class="line">    wd-&gt;subEntityTraits().setFillType(kAcGiFillNever);</div><div class="line"></div><div class="line">    wd-&gt;geometry().circle(center(), radius(), normal());</div><div class="line"></div><div class="line">    AcGePoint3dArray rectarray;</div><div class="line">    AcGePoint3d ptTemp;</div><div class="line">    <span class="keywordtype">double</span> textHeight = radius() / 2;</div><div class="line">    <span class="keywordtype">double</span> rectsidelen = textHeight * 1.1;</div><div class="line">    ptTemp = center();</div><div class="line">    ptTemp[X] += rectsidelen / 2;</div><div class="line">    ptTemp[Y] += rectsidelen / 2;</div><div class="line">    rectarray.append(ptTemp);</div><div class="line">    ptTemp[X] -= rectsidelen;</div><div class="line">    rectarray.append(ptTemp);</div><div class="line">    ptTemp[Y] -= rectsidelen;</div><div class="line">    rectarray.append(ptTemp);</div><div class="line">    ptTemp[X] += rectsidelen;</div><div class="line">    rectarray.append(ptTemp);</div><div class="line">    ptTemp[Y] += rectsidelen;</div><div class="line">    rectarray.append(ptTemp);</div><div class="line">    wd-&gt;geometry().polyline(5, rectarray.asArrayPtr(), &amp;normal());</div><div class="line"></div><div class="line">    AcGePoint3dArray lineptarray;</div><div class="line">    lineptarray.append(rectarray[0]);</div><div class="line">    ptTemp = center() + (lineptarray[0] - center()).normalize() * radius();</div><div class="line">    lineptarray.append(ptTemp);</div><div class="line">    wd-&gt;geometry().polyline(2, lineptarray.asArrayPtr(), &amp;normal());</div><div class="line"></div><div class="line">    lineptarray.removeAll();</div><div class="line">    lineptarray.append(rectarray[1]);</div><div class="line">    ptTemp = center() + (lineptarray[0] - center()).normalize() * radius();</div><div class="line">    lineptarray.append(ptTemp);</div><div class="line">    wd-&gt;geometry().polyline(2, lineptarray.asArrayPtr(), &amp;normal());</div><div class="line"></div><div class="line">    lineptarray.removeAll();</div><div class="line">    lineptarray.append(rectarray[2]);</div><div class="line">    ptTemp = center() + (lineptarray[0] - center()).normalize() * radius();</div><div class="line">    lineptarray.append(ptTemp);</div><div class="line">    wd-&gt;geometry().polyline(2, lineptarray.asArrayPtr(), &amp;normal());</div><div class="line"></div><div class="line">    lineptarray.removeAll();</div><div class="line">    lineptarray.append(rectarray[3]);</div><div class="line">    ptTemp = center() + (lineptarray[0] - center()).normalize() * radius();</div><div class="line">    lineptarray.append(ptTemp);</div><div class="line">    wd-&gt;geometry().polyline(2, lineptarray.asArrayPtr(), &amp;normal());</div><div class="line"></div><div class="line">    AcDbMText* pText = <span class="keyword">new</span> AcDbMText();</div><div class="line">    pText-&gt;setDatabaseDefaults();</div><div class="line">    pText-&gt;setNormal(normal());</div><div class="line">    pText-&gt;setContents(text());</div><div class="line">    pText-&gt;setTextHeight(textHeight);</div><div class="line">    pText-&gt;setColor(textTrueColor());</div><div class="line">    pText-&gt;setLocation(center());</div><div class="line">    pText-&gt;setAttachment(AcDbMText::kMiddleCenter);</div><div class="line">    pText-&gt;worldDraw(wd);</div><div class="line">    <span class="keyword">delete</span> pText;</div><div class="line">    pText = NULL;</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> Adesk::kTrue;</div><div class="line">}</div><div class="line">Acad::ErrorStatus ZsdkSign::subExplode(AcDbVoidPtrArray&amp; entitySet)<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">    assertReadEnabled();</div><div class="line"></div><div class="line">    AcDbCircle *pCircle = <span class="keyword">new</span> AcDbCircle( center(), normal(), radius() );</div><div class="line">    entitySet.append( pCircle );</div><div class="line"></div><div class="line">    AcDbLine *pLine = NULL;</div><div class="line"></div><div class="line">    AcGePoint3dArray rectarray;</div><div class="line">    AcGePoint3d ptTemp;</div><div class="line">    <span class="keywordtype">double</span> textHeight = radius() / 2;</div><div class="line">    <span class="keywordtype">double</span> rectsidelen = textHeight * 1.1;</div><div class="line">    ptTemp = center();</div><div class="line">    ptTemp[X] += rectsidelen / 2;</div><div class="line">    ptTemp[Y] += rectsidelen / 2;</div><div class="line">    rectarray.append(ptTemp);</div><div class="line">    ptTemp[X] -= rectsidelen;</div><div class="line">    rectarray.append(ptTemp);</div><div class="line">    ptTemp[Y] -= rectsidelen;</div><div class="line">    rectarray.append(ptTemp);</div><div class="line">    ptTemp[X] += rectsidelen;</div><div class="line">    rectarray.append(ptTemp);</div><div class="line">    ptTemp[Y] += rectsidelen;</div><div class="line">    rectarray.append(ptTemp);</div><div class="line"></div><div class="line">    pLine = <span class="keyword">new</span> AcDbLine( rectarray[0], rectarray[1] );</div><div class="line">    entitySet.append( pLine );</div><div class="line">    pLine = <span class="keyword">new</span> AcDbLine( rectarray[1], rectarray[2] );</div><div class="line">    entitySet.append( pLine );</div><div class="line">    pLine = <span class="keyword">new</span> AcDbLine( rectarray[2], rectarray[3] );</div><div class="line">    entitySet.append( pLine );</div><div class="line">    pLine = <span class="keyword">new</span> AcDbLine( rectarray[3], rectarray[0] );</div><div class="line">    entitySet.append( pLine );</div><div class="line"></div><div class="line">    AcGePoint3dArray lineptarray;</div><div class="line">    lineptarray.append(rectarray[0]);</div><div class="line">    ptTemp = center() + (lineptarray[0] - center()).normalize() * radius();</div><div class="line">    lineptarray.append(ptTemp);</div><div class="line"></div><div class="line">    pLine = <span class="keyword">new</span> AcDbLine( lineptarray[0], lineptarray[1] );</div><div class="line">    entitySet.append( pLine );</div><div class="line"></div><div class="line">    lineptarray.removeAll();</div><div class="line">    lineptarray.append(rectarray[1]);</div><div class="line">    ptTemp = center() + (lineptarray[0] - center()).normalize() * radius();</div><div class="line">    lineptarray.append(ptTemp);</div><div class="line"></div><div class="line">    pLine = <span class="keyword">new</span> AcDbLine( lineptarray[0], lineptarray[1] );</div><div class="line">    entitySet.append( pLine );</div><div class="line"></div><div class="line">    lineptarray.removeAll();</div><div class="line">    lineptarray.append(rectarray[2]);</div><div class="line">    ptTemp = center() + (lineptarray[0] - center()).normalize() * radius();</div><div class="line">    lineptarray.append(ptTemp);</div><div class="line"></div><div class="line">    pLine = <span class="keyword">new</span> AcDbLine( lineptarray[0], lineptarray[1] );</div><div class="line">    entitySet.append( pLine );</div><div class="line"></div><div class="line">    lineptarray.removeAll();</div><div class="line">    lineptarray.append(rectarray[3]);</div><div class="line">    ptTemp = center() + (lineptarray[0] - center()).normalize() * radius();</div><div class="line">    lineptarray.append(ptTemp);</div><div class="line"></div><div class="line">    pLine = <span class="keyword">new</span> AcDbLine( lineptarray[0], lineptarray[1] );</div><div class="line">    entitySet.append( pLine );</div><div class="line"></div><div class="line">    AcDbMText* pText = <span class="keyword">new</span> AcDbMText();</div><div class="line">    pText-&gt;setDatabaseDefaults();</div><div class="line">    pText-&gt;setNormal(normal());</div><div class="line">    pText-&gt;setContents(text());</div><div class="line">    pText-&gt;setTextHeight(textHeight);</div><div class="line">    pText-&gt;setColor(textTrueColor());</div><div class="line">    pText-&gt;setLocation(center());</div><div class="line">    pText-&gt;setAttachment(AcDbMText::kMiddleCenter);</div><div class="line">    entitySet.append( pText );</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> Acad::eOk;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> ZsdkSign::subList()<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">    assertReadEnabled();</div><div class="line"></div><div class="line">    AcGePoint3d cen(center());</div><div class="line"></div><div class="line">    AcDbEntity::subList();</div><div class="line">    acutPrintf(</div><div class="line">        _T(<span class="stringliteral">&quot;%12scenter point, X=%9.16q0  Y=%9.16q0  Z=%9.16q0\n&quot;</span>)</div><div class="line">        _T(<span class="stringliteral">&quot;%11s radius %9.16q0\n&quot;</span>),</div><div class="line">        _T(<span class="stringliteral">&quot;&quot;</span>), cen[X], cen[Y], cen[Z],</div><div class="line">        _T(<span class="stringliteral">&quot;&quot;</span>), radius()</div><div class="line">        );</div><div class="line">}</div><div class="line">Acad::ErrorStatus ZsdkSign::subGetGripPoints(AcGePoint3dArray&amp; gripPoints,</div><div class="line">                                          AcDbIntArray&amp; osnapModes,</div><div class="line">                                          AcDbIntArray&amp; geomIds)<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">    assertReadEnabled();</div><div class="line"></div><div class="line">    AcGePoint3d cen( center() );</div><div class="line">    gripPoints.append( cen );</div><div class="line"></div><div class="line">    AcGeVector3d xoff( radius(), 0, 0 );</div><div class="line">    AcGeVector3d yoff( 0, radius(), 0 );</div><div class="line">    gripPoints.append( cen + xoff );</div><div class="line">    gripPoints.append( cen + yoff );</div><div class="line">    gripPoints.append( cen - xoff );</div><div class="line">    gripPoints.append( cen - yoff );</div><div class="line">    <span class="keywordflow">return</span> Acad::eOk;</div><div class="line">}</div><div class="line">Acad::ErrorStatus ZsdkSign::subMoveGripPointsAt(<span class="keyword">const</span> AcDbIntArray&amp; indices,</div><div class="line">                                             <span class="keyword">const</span> AcGeVector3d&amp; offset)</div><div class="line">{</div><div class="line">    assertWriteEnabled();</div><div class="line"></div><div class="line">    AcGePoint3dArray eyearray;</div><div class="line">    AcGePoint3d oldquad, newquad;</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = 0; i &lt; indices.length(); i++ )</div><div class="line">    {</div><div class="line">        <span class="keywordtype">int</span> idx = indices[i];</div><div class="line">        <span class="keywordflow">switch</span>( idx )</div><div class="line">        {</div><div class="line">        <span class="keywordflow">case</span> 0:</div><div class="line">            setCenter( center() + offset );</div><div class="line">            <span class="keywordflow">continue</span>;</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> 1:</div><div class="line">            oldquad = center() + AcGeVector3d( radius(), 0, 0 );</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> 2:</div><div class="line">            oldquad = center() + AcGeVector3d( 0, radius(), 0 );</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> 3:</div><div class="line">            oldquad = center() - AcGeVector3d( radius(), 0, 0 );</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> 4:</div><div class="line">            oldquad = center() - AcGeVector3d( 0, radius(), 0 );</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line">        newquad = oldquad + offset;</div><div class="line">        setRadius( newquad.distanceTo( center() ));</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> Acad::eOk;</div><div class="line">}</div><div class="line"></div><div class="line">Acad::ErrorStatus ZsdkSign::subTransformBy(<span class="keyword">const</span> AcGeMatrix3d&amp; xform)</div><div class="line">{</div><div class="line">    assertWriteEnabled();</div><div class="line"></div><div class="line">    setCenter(center().transformBy(xform));</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> Acad::eOk;</div><div class="line">}</div><div class="line">Acad::ErrorStatus ZsdkSign::subGetGeomExtents( AcDbExtents&amp; )<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">    <span class="keywordflow">return</span> eOk;</div><div class="line">}</div><div class="line">Acad::ErrorStatus ZsdkSign::subGetClassID(CLSID* pClsid)<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">    assertReadEnabled();</div><div class="line">    <span class="keywordflow">if</span> (s_bHasClsid)</div><div class="line">    {</div><div class="line">         *pClsid = s_clsid;</div><div class="line">        <span class="keywordflow">return</span> Acad::eOk;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> Acad::eNotImplementedYet;</div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="keywordtype">void</span> ZsdkSign::initCLSID()</div><div class="line">{</div><div class="line">    s_bHasClsid = SUCCEEDED(CLSIDFromProgID(L<span class="stringliteral">&quot;SignDb.Entity&quot;</span>, &amp;s_clsid));</div><div class="line">    <span class="keywordflow">if</span> (!s_bHasClsid)</div><div class="line">    {</div><div class="line">        HMODULE hModule = GetModuleHandle(_T(<span class="stringliteral">&quot;SignDb.zrx&quot;</span>));</div><div class="line">        TCHAR szBuf[MAX_PATH] = {0};</div><div class="line">        ::GetModuleFileName(hModule, szBuf, MAX_PATH);</div><div class="line">        _tcscpy(szBuf + _tcslen(szBuf) - _tcslen(_T(<span class="stringliteral">&quot;SignDb.zrx&quot;</span>)), _T(<span class="stringliteral">&quot;SignDbCom.dll&quot;</span>));</div><div class="line">        HMODULE hMod = ::LoadLibrary(szBuf);</div><div class="line">        <span class="keywordflow">if</span> (hMod)</div><div class="line">        {</div><div class="line">            <span class="keyword">typedef</span> HRESULT (WINAPI *SETUP)(void);</div><div class="line">            SETUP pSetUp = (SETUP)GetProcAddress(hMod, <span class="stringliteral">&quot;SetUp&quot;</span>);</div><div class="line">            <span class="keywordflow">if</span> (pSetUp)</div><div class="line">            {</div><div class="line">                pSetUp();</div><div class="line">                s_bHasClsid = SUCCEEDED(CLSIDFromProgID(L<span class="stringliteral">&quot;SignDb.Entity&quot;</span>, &amp;s_clsid));</div><div class="line">            }</div><div class="line">            ::FreeLibrary(hMod);</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="comment">//If you want to learn more about &quot;SignDbCom.dll&quot; you can check out the SignDbCom project in the samples/Sign example.</span></div><div class="line">AcGeVector3d ZsdkSign::normal()<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">    assertReadEnabled();</div><div class="line">    <span class="keywordflow">return</span> mNormal;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> ZsdkSign::setNormal(<span class="keyword">const</span> AcGeVector3d v)</div><div class="line">{</div><div class="line">    assertWriteEnabled();</div><div class="line">    mNormal = v;</div><div class="line">    recordGraphicsModified();</div><div class="line">}</div><div class="line"></div><div class="line">AcGePoint3d ZsdkSign::center()<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">    assertReadEnabled();</div><div class="line">    <span class="keywordflow">return</span> mCenter;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> ZsdkSign::setCenter(<span class="keyword">const</span> AcGePoint3d c)</div><div class="line">{</div><div class="line">    assertWriteEnabled();</div><div class="line">    mCenter = c;</div><div class="line">    recordGraphicsModified();</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">double</span> ZsdkSign::radius()<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">    assertReadEnabled();</div><div class="line">    <span class="keywordflow">return</span> mRadius;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> ZsdkSign::setRadius(<span class="keyword">const</span> <span class="keywordtype">double</span> r)</div><div class="line">{</div><div class="line">    assertWriteEnabled();</div><div class="line">    mRadius = r;</div><div class="line">    recordGraphicsModified();</div><div class="line">}</div><div class="line"></div><div class="line">AcCmColor ZsdkSign::textTrueColor()<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">    assertReadEnabled();</div><div class="line">    <span class="keywordflow">return</span> mTextColor;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> ZsdkSign::setTextTrueColor(<span class="keyword">const</span> AcCmColor&amp; color)</div><div class="line">{</div><div class="line">    assertWriteEnabled();</div><div class="line">    mTextColor = color;</div><div class="line">    recordGraphicsModified();</div><div class="line">}</div><div class="line"></div><div class="line">AcString ZsdkSign::text()<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">    assertReadEnabled();</div><div class="line">    <span class="keywordflow">return</span> mText;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> ZsdkSign::setText(<span class="keyword">const</span> AcString&amp; t)</div><div class="line">{</div><div class="line">    assertWriteEnabled();</div><div class="line">    <span class="keywordflow">if</span> (t.length() &gt; 1)</div><div class="line">        mText = t.mid(0, 1);</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">        mText = t;</div><div class="line">    recordGraphicsModified();</div><div class="line">}</div><div class="line"></div></div><!-- fragment --> </div><!-- contents -->
<hr class="footer"/><address class="footer"><small>
<a href="https://www.zwsoft.com/zwcad/Developers/">
<img class="footer" src="../pics/zwsoft.png" alt="zwsoft"/></br>
</a>
&copy; 1998-2023  Copyright ZWSOFT CO., LTD(Guangzhou)</br>
All rights reserved.
</small></address>
</body>
</html>



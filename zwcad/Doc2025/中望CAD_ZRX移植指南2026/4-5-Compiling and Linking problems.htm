<!DOCTYPE html>
<html>
<head>
<title>编译和链接问题解决</title>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312"/>
<link type="text/css" href="../styles/style.css" rel="stylesheet" />
<link type="text/css" href="../styles/zwcadcss.css" rel="StyleSheet" />


</head>
<body>
<div id="main" class="main">
<div id="header" class="header">
<div class="header_resize">
<div class="banner">
	<div class="banner_img_right"><img src="../images/banner_img_right.png"></div>
	<div class="hear_text">中望CAD 2026 ZRX移植指南</div>
</div>
</div>
</div>
<div class="clr"></div>
    <div class="Tophead"><span class="Tophead_text">编译和链接问题解决</span></div> 
<div class="clr"></div>
<div id="content" class="content">
    <div class="content_resize">
    <div class="article">
    <div class="clr">
</div>

<p class="dev_body_text">源码工程编译生成ZRX文件过程可能会因为一些编译或者链接问题而失败，开发者需要根据编译器的报错信息和错误码来分析失败原因、解决编译问题，最终成功生成目标ZRX文件。Visual Studio官方文档价绍了各种编译错误以及可能的原因，参见<A href="https://learn.microsoft.com/en-us/cpp/error-messages/compiler-errors-1/c-cpp-build-errors?view=msvc-150" target="_blank">C/C++编译器和构建工具错误和警告</A>，下文也将介绍一些常见的编译链接问题。</p>
<p class="dev_body_text">几种常见的错误类型：</p>
<ul class="command_ul">
    <li class="dev_body_text">CXXXX：C++编译错误，如C3861('identifier': identifier not found)。</li>
    <li class="dev_body_text">LNKXXXX：链接错误，如LNK2019(unresolved external symbol 'symbol' referenced in function 'function')。</li>
    <li class="dev_body_text">RCXXXX：资源编译错误，如RC4005('identifier' : macro redefinition)。</li>
</ul>

<hr algin="left" >
<p class="define_head_1">常见错误解决方法</p>

<p class="define_head_2"><A href="https://learn.microsoft.com/en-us/cpp/error-messages/compiler-errors-1/fatal-error-c1189?view=msvc-150" target="_blank">C1189(#error：用户提供的错误消息)</A></p>
<p class="define_text_2">开发人员使用#error指令指定错误消息文本，需要按照错误消息的提示来解决。常见问题如下：</p>
<ul class="command_ul">
    <li class="define_text_1">包含了MFC头文件但是没有指定_AFXDLL宏。比如包含了afxwin.h头文件但是没有指定_AFXDLL宏。</li>
</ul>

<p class="define_head_2"><A href="https://learn.microsoft.com/en-us/cpp/error-messages/compiler-errors-1/compiler-error-c2065?view=msvc-150" target="_blank">C2065(未声明的标识符)</A></p>
<p class="define_text_2">编译器找不到标识符的声明，需要在源码和包含的头文件中搜索导致报错的标识符是否声明以及声明的文件和作用域。常见问题如下：</p>
<ul class="command_ul">
    <li class="define_text_1">没有包含变量类型对应的头文件。比如创建CAcModuleResourceOverride类型实例但是没有包含AcExtensionModule.h头文件。</li>
    <li class="define_text_1">变量类型没有添加命名空间。比如直接使用FontPitch声明变量，而不是使用Autodesk::AutoCAD::PAL::FontUtils::FontPitch声明变量。</li>
</ul>

<p class="define_head_2"><A href="https://learn.microsoft.com/en-us/cpp/error-messages/compiler-errors-1/compiler-errors-c2400-through-c2499?view=msvc-150" target="_blank">C2416(属性"attribute"不能应用于此上下文)</A></p>
<p class="define_text_2">当前编译器不支持报错的属性。常见问题如下：</p>
<ul class="command_ul">
    <li class="define_text_1">平台工具集低于v141，但是使用到了C++14支持的<a href="https://learn.microsoft.com/zh-cn/cpp/cpp/deprecated-cpp?view=msvc-170">[[deprecated]]属性</a>。比如将ObjectARX2018向导生成ARX程序(对应vs2015(v140))移植到中望CAD2025，仍然使用Autodesk.arx-2018.props属性表文件(其中定义了全局的平台工具集<ArxSDKPlatform>v140</ArxSDKPlatform>)，没有成功将平台工具集设置成v141，编译zdbcolor.h文件时就会失败，输出错误信息：
        <p>error C2416：不能在此上下文中应用属性 "deprecated("Use default constructor followed by call to setNone(), setByBlock(), setByLayer(), etc")"。</p></li>
</ul>

<p class="define_head_2"><A href="https://learn.microsoft.com/en-us/cpp/error-messages/compiler-errors-2/compiler-error-c3861?view=msvc-150" target="_blank">C3861(找不到标识符)</A></p>
<p class="define_text_2">即使使用依赖于参数的查找，编译器也无法解析对标识符的引用，需要在源码和包含的头文件中搜索导致报错的标识符是否声明以及声明的文件和作用域。常见问题如下：</p>
<ul class="command_ul">
    <li class="define_text_1">没有包含函数的头文件。比如调用了acedCommandS函数但是没有包含acedCmdNF.h头文件。</li>
    <li class="define_text_1">没有添加函数的命名空间。比如调用getGroupName函数来获取组名，而不是调用AcDbDictUtil::getGroupName。</li>
</ul>

<p class="define_head_2"><A href="https://learn.microsoft.com/en-us/cpp/error-messages/compiler-errors-2/compiler-error-c3861?view=msvc-150" target="_blank">C2664(“函数”: 无法将自变量 n 从“类型 1”转换为“类型 2”)</A></p>
<p class="define_text_2">传递给函数的参数类型和函数期望的参数类型不一致。常见问题如下：</p>
<ul class="command_ul">
    <li class="define_text_1">字符串参数和函数支持的字符集不一致。比如将工程字符集设置成多字节字符集(MBCS)时zcutNewString函数中传入多字节字符串，输出错误信息：
    <p>xxx\zrxsdk2025\inc\zacedads.h(285): error C2664: “Zcad::ErrorStatus zcutNewString(const ZTCHAR *,ZTCHAR *&)”: 无法将参数 1 从“const char *”转换为“const ZTCHAR *”</p>
    </li>
</ul>

<p class="define_head_2"><A href="https://learn.microsoft.com/en-us/cpp/error-messages/tool-errors/linker-tools-error-lnk2019?view=msvc-150" target="_blank">LNK2019(无法解析的外部符号)</A></p>
<p class="define_text_2">函数的编译代码对符号进行了引用或调用，但链接器在任何库或目标文件中都找不到该符号定义。常见问题如下：</p>
<ul class="command_ul">
<li class="define_text_1">依赖的静态库中没有导出所调用的函数或者没有添加导出调用函数对应的静态库。比如调用了acedCommandS函数但是没有添加ZWCAD.lib依赖。</li>
<li class="define_text_1">调用函数名称、参数、调用约定和函数声明不一致。比如通过extern声明acedPostCommand函数后但是没有将acedPostCommand宏替换成zcedPostCommand。
<pre class="code_sample_inLine">
// 未包含"udocapi.h"头文件或者未将acedPostCommand宏替换成zcedPostCommand，将会出现LNK2019链接错误
//#include "udocapi.h"
void test()
{
    extern Adesk::Boolean acedPostCommand(const ACHAR * cmd);
    Adesk::Boolean retValue = acedPostCommand(_T("about\n"));
}
</pre>
</li>
</ul>

</div>
</div>
</div>
<div class="blank"></div>
<div class="footer_placeholder"></div>
</div>
<div id="fbg" class="fbg">
<div class="footer">
<span class="lr">&copy; 1998-2025 ZWSOFT CO., LTD.(Guangzhou). All Rights Reserved.</span>
<div class="clr"></div>
</div>
</div> 
</body>
</html>
<!DOCTYPE html>
<html>
<head>
<title>ZRX程序自动加载方式</title>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312"/>
<link type="text/css" href="../styles/style.css" rel="stylesheet" />
<link type="text/css" href="../styles/zwcadcss.css" rel="StyleSheet" />


</head>
<body>
<div id="main" class="main">
<div id="header" class="header">
<div class="header_resize">
<div class="banner">
	<div class="banner_img_right"><img src="../images/banner_img_right.png"></div>
	<div class="hear_text">中望CAD 2026 ZRX移植指南</div>
</div>
</div>
</div>
<div class="clr"></div>
    <div class="Tophead"><span class="Tophead_text">ZRX程序自动加载方式</span></div> 
<div class="clr"></div>
<div id="content" class="content">
    <div class="content_resize">
    <div class="article">
    <div class="clr"></div>

<p class="dev_body_text">在中望CAD中，开发者可以使用下面的这些方法实现启动中望CAD时自动加载开发者的二次开发程序。</p>


<hr algin="left" >
<p class="define_head_1">ZWCAD(202x).lsp</p>
<p class="define_text_1">在中望CAD中，打开文档时会加载特定的一些lisp文件(如下)，开发者可以通过这些随文档加载的lisp文件加载自己的二次开发程序。开发者可以在中望CAD的支持文件搜索路径中添加以下lisp文件，并在lisp文件中加载二次开发程序。</p>
<ul class="command_ul">
    <li class="dev_body_text">ZWCAD.lsp，需要用户自行添加到支持文件搜索路径中。</li>
    <li class="dev_body_text">ZWCAD2026.lsp，一般是在中望CAD安装目录的Support文件夹中，如"D:\Program Files\ZWSOFT\ZWCAD 2026\Support\ZWCAD2026.lsp"，可以在命令行中执行(findfile "ZWCAD2026.lsp")语句查询。</li>
    <li class="dev_body_text">ZWCAD2026DOC.lsp，一般是在中望CAD安装目录的Support文件夹的语言目录中，如"D:\Program Files\ZWSOFT\ZWCAD 2026\Support\zh-CN\ZWCAD2026DOC.lsp"，可以在命令行中执行(findfile "ZWCAD2026DOC.lsp")语句查询。</li>
</ul>
<p class="define_text_1">在lisp文件中通过调用load函数或者执行netload等命令来加载二次开发程序，如果ZRX等文件已经在中望CAD的支持文件搜索路径中，可以只传入文件名，否则需要完整路径。可以在命令行中执行findfile函数判断文件是否在支持文件搜索路径中。</p>
<pre class="code_sample">
(load "sample.lsp")                  ;加载lisp文件
(zrxload "sample1.zrx")              ;加载zrx文件
(arxload "sample2.zrx")              ;加载zrx文件
(command "netload" "sample.dll")     ;加载dll文件
</pre>
<div class="define_text_1">
<table class="note-table">
    <tr>
    <td class="note-table-img"><IMG class=note-img src="../images/note.gif"></td>
    <td class="note-table-title"><span class="note-title">注意</span></td>
    <td class="note-table-text"><span class="note-text">中望CAD纯平台的产品名为ZWCAD，所以自动加载的lisp文件为ZWCAD(202x).lsp，然而基于中望CAD的OEM产品一般都会修改产品名，自动加载的lisp文件名也会随之改变。比如中望机械和中望建筑OEM版本的产品名修改成了ZWCADA和ZWCADM，对应加载的lisp文件名为ZWCADA(202x).lsp和ZWCADM(202x).lsp。</span></td>
    </tr>
</table>
</div>

<hr algin="left" >
<p class="define_head_1">命令行参数</p>
<p class="define_text_1">通过"/ld"命令行参数加载指定的zrx文件，如果路径或文件名中包含空格需要使用双引号将路径或文件名引起来，如果未提供任何路径信息将加载支持文件搜索路径中对应的文件。</p>
<pre class="code_sample">
"D:\Program Files\ZWSOFT\ZWCAD 2026\zwcad.exe" /ld "D:\MyPlugApp\sample.zrx"
</pre>
<p class="define_text_1">通过"/b"命令行参数加载指定的scr文件，然后在scr文件中使用命令或者lisp语句加载二次开发程序。</p>
<pre class="code_sample">
<span class="comment">;startup.scr</span>
(zrxload "D:\\MyPlugApp\\sample.zrx") 
</pre>
<pre class="code_sample">
"D:\Program Files\ZWSOFT\ZWCAD 2026\zwcad.exe" /b "D:\MyPlugApp\startup.scr"
</pre>

<hr algin="left" >
<p class="define_head_1">ZWCAD.rx</p>
<p class="define_text_1">像AutoCAD的acad.rx文件一样，中望CAD支持通过支持文件搜索路径中的ZWCAD.rx文件来加载ZRX程序，在zwcad.rx中添加需要加载的zrx文件。</p>
<pre class="code_sample">
// 支持文件搜索路径中zrx程序
sample1.zrx
sample2.zrx
// 相对路径, 比如MyPlugApp文件夹在支持文件搜索路径中，加载其子文件夹2026中的sample3.zrx
2026\sample3.zrx
// 绝对路径
D:\MyPlugApp\sample4.zrx
</pre>

<hr algin="left" >
<p class="define_head_1">启动组(AppAutoLoad.app)</p>
<p class="define_text_1">中望CAD的appload命令可以将需要随中望CAD启动加载的文件添加到启动组中，这些文件记录在支持文件搜索路径中AppAutoLoad.app文件中(一般在"%AppData%\ZWSOFT\ZWCAD\年度版本\语言版本"目录中，如%AppData%\ZWSOFT\ZWCAD\2026\zh-CN)，所以也可以通过向AppAutoLoad.app文件中添加需要加载的文件来实现自动加载。</p>
<pre class="code_sample">
D:/MyPlugApp/startup.lsp
D:/MyPlugApp/sample.zrx
D:/MyPlugApp/sample.zvb
</pre>

<hr algin="left" >
<p class="define_head_1">注册表</p>
<p class="define_text_1">开发者还可以通过配置中望CAD对应的注册表来指定需要加载的ZRX和.NET程序以及加载方式。</p>
<table class="table-desc">
    <TR>
    <TH>注册表项</TH>
    <TH>说明</TH>
    <TH>示例</TH>
    </TR>
    <TR>
    <td class="table-item-odd">HKEY_CURRENT_USER\SOFTWARE\ZWSOFT(公司名)\ZWCAD(产品名)\年度版本\语言版本\Applications</td>
    <td class="table-item-odd">仅对当前用户有效</td>
    <td class="table-item-odd">HKEY_CURRENT_USER\SOFTWARE\ZWSOFT\ZWCAD\2026\zh-CN\Applications</td>
    </TR>
    <TR>
    <td class="table-item-odd">HKEY_LOCAL_MACHINE\SOFTWARE\ZWSOFT(公司名)\ZWCAD(产品名)\年度版本\语言版本\Applications</td>
    <td class="table-item-odd">对所有用户有效</td>
    <td class="table-item-odd">HKEY_LOCAL_MACHINE\SOFTWARE\ZWSOFT\ZWCAD\2026\zh-CN\Applications</td>
    </TR>
</table>
<p class="define_text_1">中望CAD启动时自动加载ZRX程序，REG文件示例：</p>
<pre class="code_sample">
Windows Registry Editor Version 5.00

[HKEY_LOCAL_MACHINE\SOFTWARE\ZWSOFT\ZWCAD\2026\zh-CN\Applications\ZwLoadCmds]
"DESCRIPTION"=""
"LOADCTRLS"=dword:0000000f
"LOADER"="ZwLoadCmds.zrx"
    
[HKEY_LOCAL_MACHINE\SOFTWARE\ZWSOFT\ZWCAD\2026\zh-CN\Applications\ZwLoadCmds\Commands]
"APPLOAD"="APPLOAD"
    
[HKEY_LOCAL_MACHINE\SOFTWARE\ZWSOFT\ZWCAD\2026\zh-CN\Applications\ZwLoadCmds\Groups]
"ZW_LOAD_COMMANDS"="ZW_LOAD_COMMANDS"
</pre>
<p class="define_text_1">中望CAD启动时自动启动加载.NET程序，REG文件示例：</p>
<pre class="code_sample">
Windows Registry Editor Version 5.00

[HKEY_LOCAL_MACHINE\SOFTWARE\ZWSOFT\ZWCAD\2026\zh-CN\Applications\NetSampleDLL]
"MANAGED"=dword:00000001
"LOADER"="D:\\MyPluginApp\\sample.dll"
"LOADCTRLS"=dword:0000000c
"DESCRIPTION"=""
</pre>
<p class="define_text_1">注册表各个字段说明：</p>
<ul class="command_ul">
    <li class="dev_body_text">LOADER：要加载的程序文件，可以带路径，也可以不带路径，不带路径则按照支持文件搜索路径顺序查找文件。</li>
    <li class="dev_body_text">LOADCTRLS：加载方式，如启动加载(0x0f)、按需加载(0x0c)</li>
    <li class="dev_body_text">DESCRIPTION：对程序的描述文字。</li>
    <li class="dev_body_text">Commands：该程序注册的命令。</li>
    <li class="dev_body_text">Groups：该程序注册的命令组名称。</li>
</ul>
<p class="define_text_1">LOADCTRLS对应zrxdlinkr.h文件中的ZcadApp::LoadReasons，可以多个值组合，具体说明如下：</p>
<table class="table-desc">
    <TR>
    <TH>枚举值</TH>
    <TH>说明</TH>
    </TR>
    <TR>
    <td class="table-item-odd">kOnProxyDetection(0x01)</td>
    <td class="table-item-odd">通过open、dxfin、insert等命令加载自定义类的对象时，加载ZRX应用程序</td>
    </TR>
    <TR>
    <td class="table-item-odd">kOnAutoCADStartup(0x02)</td>
    <td class="table-item-odd">启动中望CAD时加载ZRX应用程序</td>
    </TR>
    <TR>
    <td class="table-item-odd">kOnCommandInvocation(0x04)</td>
    <td class="table-item-odd">执行具有注册表项的未知命令时加载ZRX应用程序(按需加载)</td>
    </TR>
    <TR>
    <td class="table-item-odd">kOnLoadRequest(0x08)</td>
    <td class="table-item-odd">允许通过ZcRxDynamicLinker::loadApp方法加载ZRX应用程序</td>
    </TR>
    <TR>
    <td class="table-item-odd">kLoadDisabled(0x10)</td>
    <td class="table-item-odd">由于任何原因都不要求加载ZRX应用程序</td>
    </TR>
    <TR>
    <td class="table-item-odd">kTransparentlyLoadable(0x20)</td>
    <td class="table-item-odd">透明加载ZRX应用程序</td>
    </TR>
    <TR>
    <td class="table-item-odd">kOnIdleLoad(0x40)</td>
    <td class="table-item-odd">中望CAD空闲时加载ZRX应用程序(界面初始化完成、文档打开后)</td>
    </TR>
    <TR>
    <td class="table-item-odd">kAutodeskInternal1(0x80)</td>
    <td class="table-item-odd">不支持</td>
    </TR>
</table>

<p class="define_text_1">执行命令时按需加载ZRX程序，REG文件示例：</p>
<pre class="code_sample">
Windows Registry Editor Version 5.00

[HKEY_LOCAL_MACHINE\SOFTWARE\ZWSOFT\ZWCAD\2026\zh-CN\Applications\ZwRender]
"DESCRIPTION"=""
"LOADCTRLS"=dword:0000000d
"LOADER"="rps_zwcad.zrx"

[HKEY_LOCAL_MACHINE\SOFTWARE\ZWSOFT\ZWCAD\2026\zh-CN\Applications\ZwRender\Commands]
"LIGHT"="LIGHT"
"MATERIAL"="MATERIAL"
"RENDER"="RENDER"

[HKEY_LOCAL_MACHINE\SOFTWARE\ZWSOFT\ZWCAD\2026\zh-CN\Applications\ZwRender\Groups]
"RPS_ZWCAD_COMMANDS"="RPS_ZWCAD_COMMANDS"
</pre>
<div class="define_text_1">
    <table class="note-table">
    <tr>
    <td class="note-table-img"><img class="note-img" src="../images/tips.gif"></td>
    <td class="note-table-title"><span class="note-title">提示</span></td>
    <td class="note-table-text"><span class="note-text">上面按需加载示例中，执行LIGHT等命令时，会自动加载rps_zwcad.zrx，LOADCTRLS为0x0d，表示0x01|0x04|0x08。</span></td>
    </tr>
    </table>
</div>

<hr algin="left" >
<p class="define_head_1">bundle</p>
<p class="define_text_1">通过指定和配置.bundle后缀的文件夹来实现ZRX程序的加载，中望CAD暂不支持，如果您需要这个功能，请联系邮箱<A href="mailto:zdn@zwcad.com"><span lang=EN-US style="FONT-SIZE: 12pt">zdn@zwcad.com</span></A>或者中望技术支持人员。</p>

</div>
</div>
</div>
<div class="blank"></div>
<div class="footer_placeholder"></div>
</div>
<div id="fbg" class="fbg">
<div class="footer">
<span class="lr">&copy; 1998-2025 ZWSOFT CO., LTD.(Guangzhou). All Rights Reserved.</span>
<div class="clr"></div>
</div>
</div> 
</body>
</html>